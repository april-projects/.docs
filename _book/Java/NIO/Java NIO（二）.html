<!DOCTYPE HTML><html lang="zh-hans"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Java NIO（二） · April</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content=""><meta name="generator" content="GitBook 3.2.3"><meta name="author" content="April"><link rel="stylesheet" href="../../gitbook/style.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.min.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-gtalk/gtalk.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-donate/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-insert-logo/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png"><link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon"><link rel="next" href="../SpringBoot笔记/"><link rel="prev" href="Java NIO（一）.html"><link rel="shortcut icon" href="../../https:/tencent.cos.mobaijun.com/img/gitbook/favicon.ico" type="image/x-icon"><link rel="bookmark" href="../../https:/tencent.cos.mobaijun.com/img/gitbook/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="../../https:/tencent.cos.mobaijun.com/img/gitbook/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="120x120" href="../../https:/tencent.cos.mobaijun.com/img/gitbook/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="180x180" href="../../https:/tencent.cos.mobaijun.com/img/gitbook/android-chrome-192x192.png"></head><body><div class="book"><div class="book-summary"><div id="book-search-input" role="search"><input type="text" placeholder="输入并搜索"></div><nav role="navigation"><ul class="summary"><li><a href="https://www.mobaijun.com" target="_blank" class="custom-link">框架师</a></li><li><a href="https://github.com/mobaijun" target="_blank" class="custom-link">GitHub</a></li><li><a href="https://gitee.com/mobaijun" target="_blank" class="custom-link">Gitee</a></li><li><a href="https://nav.mobaijun.com" target="_blank" class="custom-link">寻·妙</a></li><li class="divider"></li><li class="chapter" data-level="1.1" data-path="../../"><a href="../../"><b>1.1.</b> README</a></li><li class="chapter" data-level="1.2" data-path="../../codesytel/"><a href="../../codesytel/"><b>1.2.</b> 常用编程技巧和代码规范总结</a></li><li class="chapter" data-level="1.3" data-path="../../"><a href="../../"><b>1.3.</b> Java</a><ul class="articles"><li class="chapter" data-level="1.3.1" data-path="../JavaSE 笔记 2023重制版/"><a href="../JavaSE 笔记 2023重制版/"><b>1.3.1.</b> JavaSE 2023重制版</a><ul class="articles"><li class="chapter" data-level="1.3.1.1" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（一）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（一）重制版.html"><b>1.3.1.1.</b> JavaSE笔记（一）重制版</a></li><li class="chapter" data-level="1.3.1.2" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（二）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（二）重制版.html"><b>1.3.1.2.</b> JavaSE笔记（二）重制版</a></li><li class="chapter" data-level="1.3.1.3" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（三）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（三）重制版.html"><b>1.3.1.3.</b> JavaSE笔记（三）重制版</a></li><li class="chapter" data-level="1.3.1.4" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（四）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（四）重制版.html"><b>1.3.1.4.</b> JavaSE笔记（四）重制版</a></li><li class="chapter" data-level="1.3.1.5" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（五）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（五）重制版.html"><b>1.3.1.5.</b> JavaSE笔记（五）重制版</a></li><li class="chapter" data-level="1.3.1.6" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（六）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（六）重制版.html"><b>1.3.1.6.</b> JavaSE笔记（六）重制版</a></li><li class="chapter" data-level="1.3.1.7" data-path="../JavaSE 笔记 2023重制版/JavaSE笔记（七）重制版.html"><a href="../JavaSE 笔记 2023重制版/JavaSE笔记（七）重制版.html"><b>1.3.1.7.</b> JavaSE笔记（七）重制版</a></li></ul></li><li class="chapter" data-level="1.3.2" data-path="../JavaSE 笔记（含新特性介绍）/"><a href="../JavaSE 笔记（含新特性介绍）/"><b>1.3.2.</b> JavaSE 新特性</a><ul class="articles"><li class="chapter" data-level="1.3.2.1" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（一）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（一）.html"><b>1.3.2.1.</b> JavaSE笔记（一）</a></li><li class="chapter" data-level="1.3.2.2" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（二）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（二）.html"><b>1.3.2.2.</b> JavaSE笔记（二）</a></li><li class="chapter" data-level="1.3.2.3" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（三）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（三）.html"><b>1.3.2.3.</b> JavaSE笔记（三）</a></li><li class="chapter" data-level="1.3.2.4" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（四）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（四）.html"><b>1.3.2.4.</b> JavaSE笔记（四）</a></li><li class="chapter" data-level="1.3.2.5" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（五）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（五）.html"><b>1.3.2.5.</b> JavaSE笔记（五）</a></li><li class="chapter" data-level="1.3.2.6" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（六）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（六）.html"><b>1.3.2.6.</b> JavaSE笔记（六）</a></li><li class="chapter" data-level="1.3.2.7" data-path="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（七）.html"><a href="../JavaSE 笔记（含新特性介绍）/JavaSE笔记（七）.html"><b>1.3.2.7.</b> JavaSE笔记（七）</a></li></ul></li><li class="chapter" data-level="1.3.3" data-path="../JavaSSM笔记/"><a href="../JavaSSM笔记/"><b>1.3.3.</b> Java SSM</a><ul class="articles"><li class="chapter" data-level="1.3.3.1" data-path="../JavaSSM笔记/Java SSM笔记（一）.html"><a href="../JavaSSM笔记/Java SSM笔记（一）.html"><b>1.3.3.1.</b> Java SSM笔记（一）</a></li><li class="chapter" data-level="1.3.3.2" data-path="../JavaSSM笔记/Java SSM笔记（二）.html"><a href="../JavaSSM笔记/Java SSM笔记（二）.html"><b>1.3.3.2.</b> Java SSM笔记（二）</a></li><li class="chapter" data-level="1.3.3.3" data-path="../JavaSSM笔记/Java SSM笔记（三）.html"><a href="../JavaSSM笔记/Java SSM笔记（三）.html"><b>1.3.3.3.</b> Java SSM笔记（三）</a></li><li class="chapter" data-level="1.3.3.4" data-path="../JavaSSM笔记/Java SSM笔记（四）.html"><a href="../JavaSSM笔记/Java SSM笔记（四）.html"><b>1.3.3.4.</b> Java SSM笔记（四）</a></li></ul></li><li class="chapter" data-level="1.3.4" data-path="../JavaWeb笔记/"><a href="../JavaWeb笔记/"><b>1.3.4.</b> JavaWeb</a><ul class="articles"><li class="chapter" data-level="1.3.4.1" data-path="../JavaWeb笔记/JavaWeb笔记（一）.html"><a href="../JavaWeb笔记/JavaWeb笔记（一）.html"><b>1.3.4.1.</b> JavaWeb笔记（一）</a></li><li class="chapter" data-level="1.3.4.2" data-path="../JavaWeb笔记/JavaWeb笔记（二）.html"><a href="../JavaWeb笔记/JavaWeb笔记（二）.html"><b>1.3.4.2.</b> JavaWeb笔记（二）</a></li><li class="chapter" data-level="1.3.4.3" data-path="../JavaWeb笔记/JavaWeb笔记（三）.html"><a href="../JavaWeb笔记/JavaWeb笔记（三）.html"><b>1.3.4.3.</b> JavaWeb笔记（三）</a></li><li class="chapter" data-level="1.3.4.4" data-path="../JavaWeb笔记/JavaWeb笔记（四）.html"><a href="../JavaWeb笔记/JavaWeb笔记（四）.html"><b>1.3.4.4.</b> JavaWeb笔记（四）</a></li><li class="chapter" data-level="1.3.4.5" data-path="../JavaWeb笔记/JavaWeb笔记（五）.html"><a href="../JavaWeb笔记/JavaWeb笔记（五）.html"><b>1.3.4.5.</b> JavaWeb笔记（五）</a></li></ul></li><li class="chapter" data-level="1.3.5" data-path="../Java设计模式笔记/"><a href="../Java设计模式笔记/"><b>1.3.5.</b> 设计模式</a><ul class="articles"><li class="chapter" data-level="1.3.5.1" data-path="../Java设计模式笔记/Java设计模式（一）.html"><a href="../Java设计模式笔记/Java设计模式（一）.html"><b>1.3.5.1.</b> Java设计模式（一）.md</a></li><li class="chapter" data-level="1.3.5.2" data-path="../Java设计模式笔记/Java设计模式（二）.html"><a href="../Java设计模式笔记/Java设计模式（二）.html"><b>1.3.5.2.</b> Java设计模式（二）.md</a></li><li class="chapter" data-level="1.3.5.3" data-path="../Java设计模式笔记/Java设计模式（三）.html"><a href="../Java设计模式笔记/Java设计模式（三）.html"><b>1.3.5.3.</b> Java设计模式（三）.md</a></li><li class="chapter" data-level="1.3.5.4" data-path="../Java设计模式笔记/Java设计模式（四）.html"><a href="../Java设计模式笔记/Java设计模式（四）.html"><b>1.3.5.4.</b> Java设计模式（四）.md</a></li></ul></li><li class="chapter" data-level="1.3.6" data-path="../../"><a href="../../"><b>1.3.6.</b> JVM</a><ul class="articles"><li class="chapter" data-level="1.3.6.1" data-path="../jvm/JVM笔记（一）.html"><a href="../jvm/JVM笔记（一）.html"><b>1.3.6.1.</b> JVM笔记（一）</a></li><li class="chapter" data-level="1.3.6.2" data-path="../jvm/JVM笔记（二）.html"><a href="../jvm/JVM笔记（二）.html"><b>1.3.6.2.</b> JVM笔记（二）</a></li><li class="chapter" data-level="1.3.6.3" data-path="../jvm/JVM笔记（三）.html"><a href="../jvm/JVM笔记（三）.html"><b>1.3.6.3.</b> JVM笔记（三）</a></li><li class="chapter" data-level="1.3.6.4" data-path="../jvm/JVM运行时区域详解.html"><a href="../jvm/JVM运行时区域详解.html"><b>1.3.6.4.</b> JVM运行时区域详解</a></li></ul></li><li class="chapter" data-level="1.3.7" data-path="../JUC/"><a href="../JUC/"><b>1.3.7.</b> JUC</a><ul class="articles"><li class="chapter" data-level="1.3.7.1" data-path="../JUC/JUC（一）.html"><a href="../JUC/JUC（一）.html"><b>1.3.7.1.</b> JUC（一）</a></li><li class="chapter" data-level="1.3.7.2" data-path="../JUC/JUC（二）.html"><a href="../JUC/JUC（二）.html"><b>1.3.7.2.</b> JUC（二）</a></li><li class="chapter" data-level="1.3.7.3" data-path="../JUC/JUC（三）.html"><a href="../JUC/JUC（三）.html"><b>1.3.7.3.</b> JUC（三）</a></li></ul></li><li class="chapter" data-level="1.3.8" data-path="./"><a href="./"><b>1.3.8.</b> NIO</a><ul class="articles"><li class="chapter" data-level="1.3.8.1" data-path="Java NIO（一）.html"><a href="Java NIO（一）.html"><b>1.3.8.1.</b> Java NIO（一）</a></li><li class="chapter active" data-level="1.3.8.2" data-path="Java NIO（二）.html"><a href="Java NIO（二）.html"><b>1.3.8.2.</b> Java NIO（二）</a></li></ul></li><li class="chapter" data-level="1.3.9" data-path="../SpringBoot笔记/"><a href="../SpringBoot笔记/"><b>1.3.9.</b> SpringBoot</a><ul class="articles"><li class="chapter" data-level="1.3.9.1" data-path="../SpringBoot笔记/SpringBoot笔记（一）.html"><a href="../SpringBoot笔记/SpringBoot笔记（一）.html"><b>1.3.9.1.</b> SpringBoot笔记（一）</a></li><li class="chapter" data-level="1.3.9.2" data-path="../SpringBoot笔记/SpringBoot笔记（二）.html"><a href="../SpringBoot笔记/SpringBoot笔记（二）.html"><b>1.3.9.2.</b> SpringBoot笔记（二）</a></li><li class="chapter" data-level="1.3.9.3" data-path="../SpringBoot笔记/SpringBoot笔记（三）.html"><a href="../SpringBoot笔记/SpringBoot笔记（三）.html"><b>1.3.9.3.</b> SpringBoot笔记（三）</a></li><li class="chapter" data-level="1.3.9.4" data-path="../SpringBoot笔记/SpringBoot笔记（四）.html"><a href="../SpringBoot笔记/SpringBoot笔记（四）.html"><b>1.3.9.4.</b> SpringBoot笔记（四）</a></li><li class="chapter" data-level="1.3.9.5" data-path="../SpringBoot笔记/SpringBoot笔记（五）.html"><a href="../SpringBoot笔记/SpringBoot笔记（五）.html"><b>1.3.9.5.</b> SpringBoot笔记（五）</a></li></ul></li><li class="chapter" data-level="1.3.10" data-path="../SpringCloud/"><a href="../SpringCloud/"><b>1.3.10.</b> SpringCloud</a><ul class="articles"><li class="chapter" data-level="1.3.10.1" data-path="../SpringCloud/SpringCloud（一）.html"><a href="../SpringCloud/SpringCloud（一）.html"><b>1.3.10.1.</b> SpringCloud（一）</a></li><li class="chapter" data-level="1.3.10.2" data-path="../SpringCloud/SpringCloud（二）.html"><a href="../SpringCloud/SpringCloud（二）.html"><b>1.3.10.2.</b> SpringCloud（二）</a></li><li class="chapter" data-level="1.3.10.3" data-path="../SpringCloud/SpringCloud（三）.html"><a href="../SpringCloud/SpringCloud（三）.html"><b>1.3.10.3.</b> SpringCloud（三）</a></li><li class="chapter" data-level="1.3.10.4" data-path="../SpringCloud/SpringCloud（四）.html"><a href="../SpringCloud/SpringCloud（四）.html"><b>1.3.10.4.</b> SpringCloud（四）</a></li></ul></li><li class="chapter" data-level="1.3.11" data-path="../算法/"><a href="../算法/"><b>1.3.11.</b> 算法</a><ul class="articles"><li class="chapter" data-level="1.3.11.1" data-path="../算法/数据结构与算法（一）.html"><a href="../算法/数据结构与算法（一）.html"><b>1.3.11.1.</b> 数据结构与算法（一）</a></li><li class="chapter" data-level="1.3.11.2" data-path="../算法/数据结构与算法（二）.html"><a href="../算法/数据结构与算法（二）.html"><b>1.3.11.2.</b> 数据结构与算法（二）</a></li><li class="chapter" data-level="1.3.11.3" data-path="../算法/数据结构与算法（三）.html"><a href="../算法/数据结构与算法（三）.html"><b>1.3.11.3.</b> 数据结构与算法（三）</a></li><li class="chapter" data-level="1.3.11.4" data-path="../算法/数据结构与算法（四）.html"><a href="../算法/数据结构与算法（四）.html"><b>1.3.11.4.</b> 数据结构与算法（四）</a></li><li class="chapter" data-level="1.3.11.5" data-path="../算法/数据结构与算法（五）.html"><a href="../算法/数据结构与算法（五）.html"><b>1.3.11.5.</b> 数据结构与算法（五）</a></li></ul></li></ul></li><li class="chapter" data-level="1.4" data-path="../../Linux/"><a href="../../Linux/"><b>1.4.</b> Linux</a><ul class="articles"><li class="chapter" data-level="1.4.1" data-path="../../Linux/Docker容器技术.html"><a href="../../Linux/Docker容器技术.html"><b>1.4.1.</b> Docker容器技术</a></li></ul></li><li class="chapter" data-level="1.5" data-path="../../other/"><a href="../../other/"><b>1.5.</b> 其他</a><ul class="articles"><li class="chapter" data-level="1.5.1" data-path="../../other/C语言程序设计/"><a href="../../other/C语言程序设计/"><b>1.5.1.</b> C语言程序设计</a><ul class="articles"><li class="chapter" data-level="1.5.1.1" data-path="../../other/C语言程序设计/C语言（一）.html"><a href="../../other/C语言程序设计/C语言（一）.html"><b>1.5.1.1.</b> C语言（一）</a></li><li class="chapter" data-level="1.5.1.2" data-path="../../other/C语言程序设计/C语言（三）.html"><a href="../../other/C语言程序设计/C语言（三）.html"><b>1.5.1.2.</b> C语言（三）</a></li><li class="chapter" data-level="1.5.1.3" data-path="../../other/C语言程序设计/C语言（二）.html"><a href="../../other/C语言程序设计/C语言（二）.html"><b>1.5.1.3.</b> C语言（二）</a></li></ul></li></ul></li><li class="divider"></li><li><a href="https://www.gitbook.com" target="blank" class="gitbook-link">本书使用 GitBook 发布</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header" role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="../..">Java NIO（二）</a></h1></div><div class="page-wrapper" tabindex="-1" role="main"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="normal markdown-section"><h1 id="netty&#x6846;&#x67B6;"><a name="netty&#x6846;&#x67B6;" class="plugin-anchor" href="#netty&#x6846;&#x67B6;"><i class="fa fa-link" aria-hidden="true"></i></a>Netty&#x6846;&#x67B6;</h1><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5B66;&#x4E60;&#x4E86;Java&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;NIO&#x6846;&#x67B6;&#xFF0C;&#x63D0;&#x4F9B;&#x4F7F;&#x7528;NIO&#x63D0;&#x4F9B;&#x7684;&#x4E09;&#x5927;&#x7EC4;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7F16;&#x5199;&#x66F4;&#x52A0;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x5BA2;&#x6237;&#x7AEF;/&#x670D;&#x52A1;&#x7AEF;&#x7F51;&#x7EDC;&#x7A0B;&#x5E8F;&#x4E86;&#xFF0C;&#x751A;&#x81F3;&#x8FD8;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x89C4;&#x5B9A;&#x4E00;&#x79CD;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p><h2 id="nio&#x6846;&#x67B6;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;"><a name="nio&#x6846;&#x67B6;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;" class="plugin-anchor" href="#nio&#x6846;&#x67B6;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>NIO&#x6846;&#x67B6;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2><p>&#x4F46;&#x662F;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;NIO&#x6846;&#x67B6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD8;&#x662F;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x76D8;&#x70B9;&#x4E00;&#x4E0B;&#x3002;</p><h3 id="&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x95ED;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x7AEF;&#x7A7A;&#x8F6E;&#x8BE2;"><a name="&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x95ED;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x7AEF;&#x7A7A;&#x8F6E;&#x8BE2;" class="plugin-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x95ED;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x7AEF;&#x7A7A;&#x8F6E;&#x8BE2;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x95ED;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x7AEF;&#x7A7A;&#x8F6E;&#x8BE2;</h3><p>&#x53EF;&#x80FD;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x9A8C;&#x4E2D;&#xFF0C;&#x4F60;&#x53D1;&#x73B0;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/0.jpg" alt="image-20220506214320210"></p><p>&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E3B;&#x52A8;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;READ&#x4E8B;&#x4EF6;&#x4E00;&#x76F4;&#x88AB;&#x89E6;&#x53D1;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;<code>selector.select()</code>&#x4F1A;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x53EF;&#x8BFB;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5B9E;&#x9645;&#x4E0A;&#x8BFB;&#x5230;&#x662F;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#xFF08;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x4E2D;&#x5728;&#x7A7A;&#x8F6E;&#x8BE2;&#x4E24;&#x6B21;&#x540E;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x4E86;&#xFF0C;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x65E0;&#x9650;&#x7684;&#x5FAA;&#x73AF;&#x4E0B;&#x53BB;&#xFF09;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5F97;&#x7A0D;&#x5FAE;&#x5904;&#x7406;&#x4E00;&#x4E0B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C;read&#x64CD;&#x4F5C;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x662F;-1&#xFF0C;&#x90A3;&#x4E48;&#x8BF4;&#x660E;&#x670D;&#x52A1;&#x7AEF;&#x5DF2;&#x7ECF;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x4E86;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x5DF2;&#x7ECF;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x4E86;&#xFF1A;&quot;</span><span class="token operator">+</span>channel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x5173;&#x95ED;&#x6B64;&#x901A;&#x9053;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#x9009;&#x62E9;</span>
    <span class="token punctuation">}</span>
    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x4E3B;&#x52A8;&#x65AD;&#x5F00;&#x65F6;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x4E86;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/1.jpg" alt="image-20220506222006550"></p><p>&#x5F53;&#x7136;&#xFF0C;&#x9664;&#x4E86;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x7A7A;&#x8F6E;&#x8BE2;&#x4E4B;&#x5916;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;NIO&#x6846;&#x67B6;&#x672C;&#x8EAB;&#x7684;BUG&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7531;&#x4E8E;&#x5E95;&#x5C42;epoll&#x673A;&#x5236;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5BFC;&#x81F4;select&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x4F1A;&#x4E00;&#x76F4;&#x8FD4;&#x56DE;0&#xFF0C;&#x9020;&#x6210;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;&#x60C5;&#x51B5;&#x3002;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x5230; &quot;</span><span class="token operator">+</span>count<span class="token operator">+</span><span class="token string">&quot; &#x4E2A;&#x4E8B;&#x4EF6;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x8BE6;&#x7EC6;&#x8BF7;&#x770B;JDK&#x5B98;&#x65B9;BUG&#x53CD;&#x9988;&#xFF1A;</p><ol><li><a href="https://link.jianshu.com/?t=http%3A%2F%2Fbugs.java.com%2Fbugdatabase%2Fview_bug.do%3Fbug_id%3D6670302" target="_blank">JDK-6670302 : (se) NIO selector wakes up with 0 selected keys infinitely</a></li><li><a href="https://link.jianshu.com/?t=http%3A%2F%2Fbugs.java.com%2Fbugdatabase%2Fview_bug.do%3Fbug_id%3D6403933" target="_blank">JDK-6403933 : (se) Selector doesn&apos;t block on Selector.select(timeout) (lnx)</a></li></ol><p>&#x672C;&#x8D28;&#x539F;&#x56E0;&#x4E5F;&#x662F;&#x56E0;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E3B;&#x52A8;&#x65AD;&#x5F00;&#x5BFC;&#x81F4;&#xFF1A;</p><blockquote><p>This is an issue with poll (and epoll) on Linux. If a file descriptor for a connected socket is polled with a request event mask of 0, and if the connection is abruptly terminated (RST) then the poll wakes up with the POLLHUP (and maybe POLLERR) bit set in the returned event set. The implication of this behaviour is that Selector will wakeup and as the interest set for the SocketChannel is 0 it means there aren&apos;t any selected events and the select method returns 0.</p></blockquote><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x672C;&#x8D28;&#x662F;&#x4E0E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6709;&#x5173;&#x7684;&#xFF0C;&#x6240;&#x4EE5;JDK&#x4E00;&#x76F4;&#x90FD;&#x8BA4;&#x4E3A;&#x662F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x7531;&#x81EA;&#x5DF1;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x5F53;&#x65F6;&#x7684;&#x597D;&#x51E0;&#x4E2A;JDK&#x7248;&#x672C;&#x90FD;&#x662F;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x4E25;&#x91CD;&#x7684;&#x7A7A;&#x8F6C;&#x95EE;&#x9898;&#xFF0C;&#x65E0;&#x9650;&#x5236;&#x5730;&#x8FDB;&#x884C;&#x7A7A;&#x8F6C;&#x64CD;&#x4F5C;&#x4F1A;&#x5BFC;&#x81F4;CPU&#x8D44;&#x6E90;&#x88AB;&#x75AF;&#x72C2;&#x6D88;&#x8017;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5374;&#x88AB;Netty&#x6846;&#x67B6;&#x5DE7;&#x5999;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x540E;&#x9762;&#x518D;&#x8BF4;&#x3002;</p><h3 id="&#x7C98;&#x5305;&#x62C6;&#x5305;&#x95EE;&#x9898;"><a name="&#x7C98;&#x5305;&#x62C6;&#x5305;&#x95EE;&#x9898;" class="plugin-anchor" href="#&#x7C98;&#x5305;&#x62C6;&#x5305;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7C98;&#x5305;/&#x62C6;&#x5305;&#x95EE;&#x9898;</h3><p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x4E0B;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5728;<code>&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;</code>&#x8FD9;&#x95E8;&#x8BFE;&#x7A0B;&#x4E2D;&#x5B66;&#x4E60;&#x8FC7;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7;TCP&#x534F;&#x8BAE;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x4F1A;&#x5148;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x653E;&#x5728;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#xFF0C;&#x800C;&#x81F3;&#x4E8E;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x771F;&#x6B63;&#x5730;&#x53D1;&#x51FA;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x662F;&#x7531;TCP&#x534F;&#x8BAE;&#x6765;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/2.jpg" alt="image-20220506224926169"></p><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6BD4;&#x5982;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x53D1;&#x9001;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x5305;&#xFF08;P1/P2&#xFF09;&#xFF0C;&#x7406;&#x60F3;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x5305;&#x5E94;&#x8BE5;&#x662F;&#x4F9D;&#x6B21;&#x5230;&#x8FBE;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5E76;&#x7531;&#x670D;&#x52A1;&#x7AEF;&#x6B63;&#x786E;&#x8BFB;&#x53D6;&#x4E24;&#x6B21;&#x6570;&#x636E;&#x51FA;&#x6765;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x4E0B;&#x9762;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</p><ol><li>&#x53EF;&#x80FD;P1&#x548C;P2&#x88AB;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#x7ED9;&#x4E86;&#x670D;&#x52A1;&#x7AEF;&#xFF08;&#x7C98;&#x5305;&#x73B0;&#x8C61;&#xFF09;</li><li>&#x53EF;&#x80FD;P1&#x548C;P2&#x7684;&#x524D;&#x534A;&#x90E8;&#x5206;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#x7ED9;&#x4E86;&#x670D;&#x52A1;&#x7AEF;&#xFF08;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#xFF09;</li><li>&#x53EF;&#x80FD;P1&#x7684;&#x524D;&#x534A;&#x90E8;&#x5206;&#x5C31;&#x88AB;&#x5355;&#x72EC;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x53D1;&#x7ED9;&#x4E86;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x548C;P2&#x4E00;&#x8D77;&#x53D1;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF08;&#x4E5F;&#x662F;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#xFF09;</li></ol><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/3.jpg" alt="image-20220506224258538"></p><p>&#x5F53;&#x7136;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p><ol><li>&#x6D88;&#x606F;&#x5B9A;&#x957F;&#xFF0C;&#x53D1;&#x9001;&#x65B9;&#x548C;&#x63A5;&#x6536;&#x65B9;&#x89C4;&#x5B9A;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x6D88;&#x606F;&#x957F;&#x5EA6;&#xFF0C;&#x4F8B;&#x5982;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x5927;&#x5C0F;&#x56FA;&#x5B9A;&#x4E3A;200&#x5B57;&#x8282;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x591F;&#xFF0C;&#x7A7A;&#x4F4D;&#x8865;&#x7A7A;&#x683C;&#xFF0C;&#x53EA;&#x6709;&#x63A5;&#x6536;&#x4E86;200&#x4E2A;&#x5B57;&#x8282;&#x4E4B;&#x540E;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li><li>&#x5728;&#x6BCF;&#x4E2A;&#x5305;&#x7684;&#x672B;&#x5C3E;&#x4F7F;&#x7528;&#x56FA;&#x5B9A;&#x7684;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x6BD4;&#x5982;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x672B;&#x5C3E;&#x90FD;&#x662F;<code>\r\n</code>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E00;&#x5B9A;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5206;&#x9694;&#x7B26;&#x624D;&#x80FD;&#x5C06;&#x524D;&#x9762;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li><li>&#x5C06;&#x6D88;&#x606F;&#x5206;&#x4E3A;&#x5934;&#x90E8;&#x548C;&#x672C;&#x4F53;&#xFF0C;&#x5728;&#x5934;&#x90E8;&#x4E2D;&#x4FDD;&#x5B58;&#x6709;&#x5F53;&#x524D;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x8BFB;&#x5230;&#x8DB3;&#x591F;&#x957F;&#x5EA6;&#x4E4B;&#x540E;&#x624D;&#x7B97;&#x662F;&#x8BFB;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</li></ol><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x6F14;&#x793A;&#x4E00;&#x4E0B;&#x7B2C;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span> serverChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        serverChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x8981;&#x6C42;&#x5FC5;&#x987B;&#x585E;&#x6EE1;30&#x4E2A;&#x5B57;&#x8282;</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230; &quot;</span><span class="token operator">+</span>size<span class="token operator">+</span><span class="token string">&quot; &#x5B57;&#x8282;&#x7684;&#x6570;&#x636E;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><p>&#x73B0;&#x5728;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FBE;&#x5230;30&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x6682;&#x65F6;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#xFF0C;&#x7B49;&#x6709;30&#x4E2A;&#x4E4B;&#x540E;&#x518D;&#x4E00;&#x6B21;&#x6027;&#x5F97;&#x5230;&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x8D85;&#x8FC7;&#x4E86;30&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x591A;&#x4E5F;&#x53EA;&#x4F1A;&#x8BFB;&#x53D6;30&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x653E;&#x5728;&#x4E0B;&#x4E00;&#x6279;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/4.jpg" alt="image-20220507102955570"></p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/5.jpg" alt="image-20220507103009255"></p><p>&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x89E3;&#x51B3;&#x7C98;&#x5305;/&#x62C6;&#x5305;&#x95EE;&#x9898;&#x4E86;&#x3002;</p><hr><h2 id="&#x8D70;&#x8FDB;netty&#x6846;&#x67B6;"><a name="&#x8D70;&#x8FDB;netty&#x6846;&#x67B6;" class="plugin-anchor" href="#&#x8D70;&#x8FDB;netty&#x6846;&#x67B6;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8D70;&#x8FDB;Netty&#x6846;&#x67B6;</h2><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x76D8;&#x70B9;&#x4E86;&#x4E00;&#x4E0B;NIO&#x5B58;&#x5728;&#x7684;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x5728;Netty&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x90FD;&#x88AB;&#x5DE7;&#x5999;&#x7684;&#x89E3;&#x51B3;&#x4E86;&#x3002;</p><p>Netty&#x662F;&#x7531;JBOSS&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;java&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5BF9;java&#x7684;nio&#x5305;&#x8FDB;&#x884C;&#x4E86;&#x518D;&#x6B21;&#x5C01;&#x88C5;&#x3002;Netty&#x6BD4;java&#x539F;&#x751F;&#x7684;nio&#x5305;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x3001;&#x7A33;&#x5B9A;&#x7684;&#x529F;&#x80FD;&#x548C;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#x7684;api&#x3002; netty&#x7684;&#x4F5C;&#x8005;&#x662F;Trustin Lee&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x97E9;&#x56FD;&#x4EBA;&#xFF0C;&#x4ED6;&#x8FD8;&#x5F00;&#x53D1;&#x4E86;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x8457;&#x540D;&#x7684;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#xFF0C;mina&#x3002;&#x4E8C;&#x8005;&#x5728;&#x5F88;&#x591A;&#x65B9;&#x9762;&#x90FD;&#x5341;&#x5206;&#x76F8;&#x4F3C;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x4E5F;&#x662F;&#x57FA;&#x672C;&#x4E00;&#x81F4; &#x3002;&#x4E0D;&#x8FC7;netty&#x793E;&#x533A;&#x7684;&#x6D3B;&#x8DC3;&#x7A0B;&#x5EA6;&#x8981;mina&#x9AD8;&#x5F97;&#x591A;&#x3002;</p><p>Netty&#x5B9E;&#x9645;&#x4E0A;&#x5E94;&#x7528;&#x573A;&#x666F;&#x975E;&#x5E38;&#x591A;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x7684;Minecraft&#x6E38;&#x620F;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/6.jpg" alt="image-20220507110120090"></p><p>Java&#x7248;&#x672C;&#x7684;Minecraft&#x670D;&#x52A1;&#x5668;&#x5C31;&#x662F;&#x4F7F;&#x7528;Netty&#x6846;&#x67B6;&#x4F5C;&#x4E3A;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x6B63;&#x662F;&#x5F97;&#x76CA;&#x4E8E;Netty&#x6846;&#x67B6;&#x7684;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x6109;&#x5FEB;&#x5730;&#x548C;&#x5176;&#x4ED6;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x4E00;&#x8D77;&#x5728;&#x670D;&#x52A1;&#x5668;&#x91CC;&#x9762;&#x70B8;&#x670D;&#x3002;</p><p>&#x5B66;&#x4E60;&#x4E86;Netty&#x6846;&#x67B6;&#x540E;&#xFF0C;&#x8BF4;&#x4E0D;&#x5B9A;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x6478;&#x7D22;&#x5230;&#x90E8;&#x5206;Minecraft&#x63D2;&#x4EF6;/&#x6A21;&#x7EC4;&#x5F00;&#x53D1;&#x7684;&#x5E95;&#x5C42;&#x7EC6;&#x8282;&#xFF08;&#x592A;&#x6298;&#x78E8;&#x4E86;&#xFF0C;UP&#x4E3B;&#x9AD8;&#x4E2D;&#x641E;&#x4E86;&#x5927;&#x534A;&#x5E74;&#x8FD9;&#x73A9;&#x610F;&#xFF09;</p><p>&#x5F53;&#x7136;&#x9664;&#x4E86;&#x6E38;&#x620F;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x5FAE;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Netty&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x6BD4;&#x5982;Dubbo&#x7684;RPC&#x6846;&#x67B6;&#xFF0C;&#x5305;&#x62EC;&#x6700;&#x65B0;&#x7684;SpringWebFlux&#x6846;&#x67B6;&#xFF0C;&#x4E5F;&#x629B;&#x5F03;&#x4E86;&#x5185;&#x5D4C;Tomcat&#x800C;&#x4F7F;&#x7528;Netty&#x4F5C;&#x4E3A;&#x901A;&#x4FE1;&#x6846;&#x67B6;&#x3002;&#x65E2;&#x7136;Netty&#x8FD9;&#x4E48;&#x5F3A;&#x5927;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;Netty&#x7684;&#x5B66;&#x4E60;&#x5427;&#xFF01;</p><p>&#x5BFC;&#x5305;&#x5148;&#xFF1A;</p><pre class="language-"><code class="lang-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.76.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="bytebuf&#x4ECB;&#x7ECD;"><a name="bytebuf&#x4ECB;&#x7ECD;" class="plugin-anchor" href="#bytebuf&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>ByteBuf&#x4ECB;&#x7ECD;</h3><p>Netty&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;NIO&#x4E2D;&#x63D0;&#x4F9B;&#x7684;ByteBuffer&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x88C5;&#x8F7D;&#xFF0C;&#x800C;&#x662F;&#x81EA;&#x884C;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;ByteBuf&#x7C7B;&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7C7B;&#x76F8;&#x6BD4;NIO&#x4E2D;&#x7684;ByteBuffer&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5462;&#xFF1F;</p><ul><li>&#x5199;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x65E0;&#x9700;&#x8FDB;&#x884C;<code>flip()</code>&#x7FFB;&#x8F6C;&#x3002;</li><li>&#x5177;&#x6709;&#x6BD4;ByteBuffer&#x66F4;&#x5FEB;&#x7684;&#x54CD;&#x5E94;&#x901F;&#x5EA6;&#x3002;</li><li>&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x3002;</li></ul><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractByteBuf</span> <span class="token keyword">extends</span> <span class="token class-name">ByteBuf</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">int</span> readerIndex<span class="token punctuation">;</span>   <span class="token comment">//index&#x88AB;&#x5206;&#x4E3A;&#x4E86;&#x8BFB;&#x548C;&#x5199;&#xFF0C;&#x662F;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x5728;&#x540C;&#x65F6;&#x5DE5;&#x4F5C;</span>
    <span class="token keyword">int</span> writerIndex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> markedReaderIndex<span class="token punctuation">;</span>    <span class="token comment">//mark&#x64CD;&#x4F5C;&#x4E5F;&#x5206;&#x4E24;&#x79CD;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> markedWriterIndex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxCapacity<span class="token punctuation">;</span>    <span class="token comment">//&#x6700;&#x5927;&#x5BB9;&#x91CF;&#xFF0C;&#x6CA1;&#x9519;&#xFF0C;&#x8FD9;&#x73A9;&#x610F;&#x80FD;&#x52A8;&#x6001;&#x6269;&#x5BB9;</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8BFB;&#x64CD;&#x4F5C;&#x548C;&#x5199;&#x64CD;&#x4F5C;&#x5206;&#x522B;&#x7531;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x5728;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;&#xFF0C;&#x6BCF;&#x5199;&#x5165;&#x4E00;&#x6B21;&#xFF0C;<code>writerIndex</code>&#x5411;&#x540E;&#x79FB;&#x52A8;&#x4E00;&#x4F4D;&#xFF0C;&#x6BCF;&#x8BFB;&#x53D6;&#x4E00;&#x6B21;&#xFF0C;&#x4E5F;&#x662F;<code>readerIndex</code>&#x5411;&#x540E;&#x79FB;&#x52A8;&#x4E00;&#x4F4D;&#xFF0C;&#x5F53;&#x7136;<code>readerIndex</code>&#x4E0D;&#x80FD;&#x5927;&#x4E8E;<code>writerIndex</code>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x50CF;NIO&#x4E2D;&#x7684;ByteBuffer&#x90A3;&#x6837;&#x8FD8;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7FFB;&#x8F6C;&#x4E86;&#x3002;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/7.jpg" alt="image-20220507160235552"></p><p>&#x5176;&#x4E2D;<code>readerIndex</code>&#x548C;<code>writerIndex</code>&#x4E4B;&#x95F4;&#x7684;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x662F;&#x53EF;&#x8BFB;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x800C;<code>writerIndex</code>&#x4E4B;&#x540E;&#x5230;<code>capacity</code>&#x90FD;&#x662F;&#x53EF;&#x5199;&#x7684;&#x90E8;&#x5206;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6765;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x4E3A;10&#x7684;ByteBuf&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;Unpooled&#x662F;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x751F;&#x6210;ByteBuf&#x7684;&#x5DE5;&#x5177;&#x7C7B;</span>
    <span class="token comment">//&#x81F3;&#x4E8E;&#x4E3A;&#x5565;&#x53EB;Unpooled&#x662F;&#x6C60;&#x5316;&#x7684;&#x610F;&#x601D;&#xFF0C;ByteBuf&#x6709;&#x6C60;&#x5316;&#x548C;&#x975E;&#x6C60;&#x5316;&#x4E24;&#x79CD;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x590D;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x518D;&#x8BA8;&#x8BBA;</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x521D;&#x59CB;&#x72B6;&#x6001;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">888888888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5199;&#x5165;&#x4E00;&#x4E2A;Int&#x6570;&#x636E;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5199;&#x5165;Int&#x540E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x65E0;&#x9700;&#x7FFB;&#x8F6C;&#xFF0C;&#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;short&#x6570;&#x636E;&#x51FA;&#x6765;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8BFB;&#x53D6;Short&#x540E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">discardReadBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4E22;&#x5F03;&#x64CD;&#x4F5C;&#xFF0C;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7684;&#x53EF;&#x8BFB;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x4E22;&#x5230;&#x6700;&#x524D;&#x9762;&#xFF0C;&#x5E76;&#x4E14;&#x8BFB;&#x5199;&#x6307;&#x9488;&#x5411;&#x524D;&#x79FB;&#x52A8;&#x4E22;&#x5F03;&#x7684;&#x8DDD;&#x79BB;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4E22;&#x5F03;&#x4E4B;&#x540E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x6E05;&#x7A7A;&#x64CD;&#x4F5C;&#xFF0C;&#x6E05;&#x7A7A;&#x4E4B;&#x540E;&#x8BFB;&#x5199;&#x6307;&#x9488;&#x90FD;&#x5F52;&#x96F6;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6E05;&#x7A7A;&#x4E4B;&#x540E;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x901A;&#x8FC7;&#x7ED3;&#x5408;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x8BFB;&#x5199;&#x6307;&#x9488;&#x7684;&#x79FB;&#x52A8;&#x60C5;&#x51B5;&#xFF0C;&#x66F4;&#x52A0;&#x6E05;&#x695A;&#x7684;&#x8BA4;&#x8BC6;&#x4E00;&#x4E0B;ByteBuf&#x7684;&#x5E95;&#x5C42;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x5212;&#x5206;&#x64CD;&#x4F5C;&#x662F;&#x4E0D;&#x662F;&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;byte[]&#x76F4;&#x63A5;&#x5305;&#x88C5;&#x8FDB;&#x7F13;&#x51B2;&#x533A;&#xFF08;&#x548C;NIO&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF09;&#x4E0D;&#x8FC7;&#x5199;&#x6307;&#x9488;&#x7684;&#x503C;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x8DD1;&#x5230;&#x6700;&#x540E;&#x53BB;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x73A9;&#x610F;&#x662F;&#x4E0D;&#x662F;&#x53EA;&#x8BFB;&#x7684;</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;abcdefg&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//&#x9664;&#x4E86;&#x5305;&#x88C5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x590D;&#x5236;&#x6570;&#x636E;&#xFF0C;copiedBuffer()&#x4F1A;&#x5B8C;&#x5B8C;&#x6574;&#x6574;&#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x4E2D;</span>
    buf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5B57;&#x8282;</span>
    <span class="token class-name">ByteBuf</span> slice <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x73B0;&#x5728;&#x8BFB;&#x6307;&#x9488;&#x4F4D;&#x4E8E;1&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5212;&#x5206;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">arrayOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5F97;&#x5230;&#x5212;&#x5206;&#x51FA;&#x6765;&#x7684;ByteBuf&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5212;&#x5206;&#x4E5F;&#x662F;&#x6839;&#x636E;&#x5F53;&#x524D;&#x8BFB;&#x53D6;&#x7684;&#x4F4D;&#x7F6E;&#x6765;&#x8FDB;&#x884C;&#x7684;&#x3002;</p><p>&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x6765;&#x770B;&#x770B;&#x5B83;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x7533;&#x8BF7;&#x4E00;&#x4E2A;&#x5BB9;&#x91CF;&#x4E3A;10&#x7684;&#x7F13;&#x51B2;&#x533A;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x5BB9;&#x91CF;&#x53EA;&#x6709;10&#x5B57;&#x8282;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//&#x76F4;&#x63A5;&#x5199;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;</span>
    buf<span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5362;&#x672C;&#x4F1F;&#x725B;&#x903C;&#xFF01;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5F88;&#x660E;&#x663E;&#x8FD9;&#x4E48;&#x591A;&#x5B57;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;10&#x5B57;&#x8282;&#x4E86;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x901A;&#x8FC7;&#x7ED3;&#x679C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x8D85;&#x51FA;&#x5F53;&#x524D;&#x5BB9;&#x91CF;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#xFF0C;&#x6269;&#x5BB9;&#x4F1A;&#x4ECE;64&#x5F00;&#x59CB;&#xFF0C;&#x4E4B;&#x540E;&#x6BCF;&#x6B21;&#x89E6;&#x53D1;&#x6269;&#x5BB9;&#x90FD;&#x4F1A;x2&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x5E0C;&#x671B;&#x5B83;&#x6269;&#x5BB9;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6700;&#x5927;&#x5BB9;&#x91CF;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x5728;&#x751F;&#x6210;&#x65F6;&#x6307;&#x5B9A;maxCapacity&#x4E5F;&#x4E3A;10</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5362;&#x672C;&#x4F1F;&#x725B;&#x903C;&#xFF01;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x73B0;&#x5728;&#x65E0;&#x6CD5;&#x518D;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x4E86;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/8.jpg" alt="image-20220507165153381"></p><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x4E09;&#x79CD;&#x5B9E;&#x73B0;&#x6A21;&#x5F0F;&#xFF1A;&#x5806;&#x7F13;&#x51B2;&#x533A;&#x6A21;&#x5F0F;&#x3001;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&#x6A21;&#x5F0F;&#x3001;&#x590D;&#x5408;&#x7F13;&#x51B2;&#x533A;&#x6A21;&#x5F0F;&#x3002;</p><p>&#x5806;&#x7F13;&#x51B2;&#x533A;&#xFF08;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#xFF09;&#x548C;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&#xFF08;&#x5806;&#x5916;&#x5185;&#x5B58;&#x5B9E;&#x73B0;&#xFF09;&#x4E0D;&#x7528;&#x591A;&#x8BF4;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5728;NIO&#x4E2D;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x8FC7;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x540C;&#x6837;&#x7684;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x62FF;&#x5230;&#x6570;&#x7EC4;&#xFF0C;&#x56E0;&#x4E3A;&#x5E95;&#x5C42;&#x538B;&#x6839;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/9.jpg" alt="image-20220507163253662"></p><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x590D;&#x5408;&#x6A21;&#x5F0F;&#xFF0C;&#x590D;&#x5408;&#x6A21;&#x5F0F;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x5730;&#x62FC;&#x51D1;&#x7EC4;&#x5408;&#x5176;&#x4ED6;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/10.jpg" alt="image-20220507171216323"></p><p>&#x8FD9;&#x6837;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5BF9;&#x4E24;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x7EC4;&#x5408;&#x7684;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x5355;&#x72EC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x5176;&#x8FDB;&#x884C;&#x62FC;&#x63A5;&#x64CD;&#x4F5C;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x4F5C;&#x4E3A;&#x591A;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x7EC4;&#x5408;&#x7684;&#x89C6;&#x56FE;&#x3002;</p><pre class="language-"><code class="lang-java"><span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x590D;&#x5408;&#x7F13;&#x51B2;&#x533A;</span>
<span class="token class-name">CompositeByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">compositeBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">addComponent</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">addComponent</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;def&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buf<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x64CD;&#x4F5C;&#x7EC4;&#x5408;&#x540E;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;</p><p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#xFF0C;&#x6C60;&#x5316;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x975E;&#x6C60;&#x5316;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x533A;&#x522B;&#x3002;</p><p>&#x6211;&#x4EEC;&#x7814;&#x7A76;&#x4E00;&#x4E0B;Unpooled&#x5DE5;&#x5177;&#x7C7B;&#x4E2D;&#x5177;&#x4F53;&#x662F;&#x5982;&#x4F55;&#x521B;&#x5EFA;buffer&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Unpooled</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ByteBufAllocator</span> <span class="token constant">ALLOC</span><span class="token punctuation">;</span>  <span class="token comment">//&#x5B9E;&#x9645;&#x4E0A;&#x5185;&#x90E8;&#x662F;&#x6709;&#x4E00;&#x4E2A;ByteBufAllocator&#x5BF9;&#x8C61;&#x7684;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ByteOrder</span> <span class="token constant">BIG_ENDIAN</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ByteOrder</span> <span class="token constant">LITTLE_ENDIAN</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ByteBuf</span> <span class="token constant">EMPTY_BUFFER</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuf</span> <span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">ALLOC</span><span class="token punctuation">.</span><span class="token function">heapBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7F13;&#x51B2;&#x533A;&#x7684;&#x521B;&#x5EFA;&#x64CD;&#x4F5C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4F9D;&#x9760;ByteBufAllocator&#x6765;&#x8FDB;&#x884C;&#x7684;</span>
    <span class="token punctuation">}</span>

      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>   <span class="token comment">//ALLOC&#x5728;&#x9759;&#x6001;&#x4EE3;&#x7801;&#x5757;&#x4E2D;&#x8FDB;&#x884C;&#x6307;&#x5B9A;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x771F;&#x6B63;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x662F;UnpooledByteBufAllocator</span>
        <span class="token constant">ALLOC</span> <span class="token operator">=</span> <span class="token class-name">UnpooledByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">;</span>
        <span class="token constant">BIG_ENDIAN</span> <span class="token operator">=</span> <span class="token class-name">ByteOrder</span><span class="token punctuation">.</span><span class="token constant">BIG_ENDIAN</span><span class="token punctuation">;</span>
        <span class="token constant">LITTLE_ENDIAN</span> <span class="token operator">=</span> <span class="token class-name">ByteOrder</span><span class="token punctuation">.</span><span class="token constant">LITTLE_ENDIAN</span><span class="token punctuation">;</span>
        <span class="token constant">EMPTY_BUFFER</span> <span class="token operator">=</span> <span class="token constant">ALLOC</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7A7A;&#x7F13;&#x51B2;&#x533A;&#x5BB9;&#x91CF;&#x548C;&#x6700;&#x5927;&#x5BB9;&#x91CF;&#x90FD;&#x662F;0</span>

        <span class="token keyword">assert</span> <span class="token constant">EMPTY_BUFFER</span> <span class="token keyword">instanceof</span> <span class="token class-name">EmptyByteBuf</span> <span class="token operator">:</span> <span class="token string">&quot;EMPTY_BUFFER must be an EmptyByteBuf.&quot;</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#xFF0C;&#x8FD9;&#x4E2A;ByteBufAllocator&#x53C8;&#x662F;&#x4E2A;&#x5565;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8D1F;&#x8D23;&#x5206;&#x914D;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x3002;</p><p>&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#xFF1A;<code>UnpooledByteBufAllocator</code>&#x548C;<code>PooledByteBufAllocator</code>&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x975E;&#x6C60;&#x5316;&#x7F13;&#x51B2;&#x533A;&#x751F;&#x6210;&#x5668;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x662F;&#x6C60;&#x5316;&#x7F13;&#x51B2;&#x533A;&#x751F;&#x6210;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x6C60;&#x5316;&#x548C;&#x975E;&#x6C60;&#x5316;&#x6709;&#x5565;&#x533A;&#x522B;&#x5462;&#xFF1F;</p><p>&#x5B9E;&#x9645;&#x4E0A;&#x6C60;&#x5316;&#x7F13;&#x51B2;&#x533A;&#x5229;&#x7528;&#x4E86;&#x6C60;&#x5316;&#x601D;&#x60F3;&#xFF0C;&#x5C06;&#x7F13;&#x51B2;&#x533A;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x5185;&#x5B58;&#x6C60;&#x6765;&#x8FDB;&#x884C;&#x5185;&#x5B58;&#x5757;&#x590D;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x9891;&#x7E41;&#x5730;&#x8FDB;&#x884C;&#x5185;&#x5B58;&#x7684;&#x7533;&#x8BF7;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5728;&#x4F7F;&#x7528;&#x5806;&#x5916;&#x5185;&#x5B58;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x907F;&#x514D;&#x591A;&#x6B21;&#x91CD;&#x590D;&#x901A;&#x8FC7;&#x5E95;&#x5C42;<code>malloc()</code>&#x51FD;&#x6570;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x9020;&#x6210;&#x7684;&#x6027;&#x80FD;&#x635F;&#x5931;&#x3002;Netty&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x4E3B;&#x8981;&#x662F;&#x501F;&#x9274;Jemalloc&#x5185;&#x5B58;&#x5206;&#x914D;&#x7B56;&#x7565;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x53EF;&#x4EE5;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x590D;&#x7528;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteBufAllocator</span> allocator <span class="token operator">=</span> <span class="token class-name">PooledByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">;</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> allocator<span class="token punctuation">.</span><span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7533;&#x8BF7;&#x4E00;&#x4E2A;&#x5BB9;&#x91CF;&#x4E3A;10&#x7684;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;</span>
    buf<span class="token punctuation">.</span><span class="token function">writeChar</span><span class="token punctuation">(</span><span class="token char">&apos;T&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x968F;&#x4FBF;&#x64CD;&#x4F5C;&#x64CD;&#x4F5C;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">readChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x91CA;&#x653E;&#x6B64;&#x7F13;&#x51B2;&#x533A;</span>

    <span class="token class-name">ByteBuf</span> buf2 <span class="token operator">=</span> allocator<span class="token punctuation">.</span><span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x91CD;&#x65B0;&#x518D;&#x7533;&#x8BF7;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x5927;&#x5C0F;&#x7684;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf2 <span class="token operator">==</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B8C;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x91CA;&#x653E;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x7533;&#x8BF7;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x5927;&#x5C0F;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x65F6;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x5F97;&#x5230;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x7533;&#x8BF7;&#x597D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;PooledByteBufAllocator&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;ByteBuf&#x5B9E;&#x4F8B;&#x653E;&#x5165;&#x6C60;&#x4E2D;&#x5728;&#x8FDB;&#x884C;&#x590D;&#x7528;&#x3002;</p><h3 id="&#x96F6;&#x62F7;&#x8D1D;&#x7B80;&#x4ECB;"><a name="&#x96F6;&#x62F7;&#x8D1D;&#x7B80;&#x4ECB;" class="plugin-anchor" href="#&#x96F6;&#x62F7;&#x8D1D;&#x7B80;&#x4ECB;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x96F6;&#x62F7;&#x8D1D;&#x7B80;&#x4ECB;</h3><p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong>&#x6B64;&#x5C0F;&#x8282;&#x4F5C;&#x4E3A;&#x9009;&#x5B66;&#x5185;&#x5BB9;&#xFF0C;&#x9700;&#x8981;&#x638C;&#x63E1;<code>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</code>&#x548C;<code>&#x8BA1;&#x7B97;&#x673A;&#x7EC4;&#x6210;&#x539F;&#x7406;</code>&#x624D;&#x80FD;&#x5B66;&#x4E60;&#x3002;</p><p>&#x96F6;&#x62F7;&#x8D1D;&#x662F;&#x4E00;&#x79CD;I/O&#x64CD;&#x4F5C;&#x4F18;&#x5316;&#x6280;&#x672F;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x9AD8;&#x6548;&#x5730;&#x5C06;&#x6570;&#x636E;&#x4ECE;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x79FB;&#x52A8;&#x5230;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5C06;&#x5176;&#x4ECE;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x590D;&#x5236;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF0C;&#x9996;&#x5148;&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#xFF0C;&#x4EC0;&#x4E48;&#x53C8;&#x662F;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x5462;&#xFF1F;</p><p>&#x5176;&#x5B9E;&#x65E9;&#x671F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x662F;&#x4E0D;&#x533A;&#x5206;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x80FD;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x7A0B;&#x5E8F;&#x5F88;&#x5BB9;&#x6613;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x5E38;&#x5E38;&#x628A;&#x7CFB;&#x7EDF;&#x641E;&#x5D29;&#x6E83;&#xFF0C;&#x6BD4;&#x5982;&#x6E05;&#x9664;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x5B58;&#x6570;&#x636E;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x8BA9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x968F;&#x4FBF;&#x8BBF;&#x95EE;&#x5185;&#x5B58;&#x771F;&#x7684;&#x592A;&#x5371;&#x9669;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x6309;&#x7167;CPU &#x6307;&#x4EE4;&#x7684;&#x91CD;&#x8981;&#x7A0B;&#x5EA6;&#x5BF9;&#x6307;&#x4EE4;&#x8FDB;&#x884C;&#x4E86;&#x5206;&#x7EA7;&#xFF0C;&#x6307;&#x4EE4;&#x5206;&#x4E3A;&#x56DB;&#x4E2A;&#x7EA7;&#x522B;&#xFF1A;Ring0 ~ Ring3&#xFF0C;Linux &#x4E0B;&#x53EA;&#x4F7F;&#x7528;&#x4E86; Ring0 &#x548C; Ring3 &#x4E24;&#x4E2A;&#x8FD0;&#x884C;&#x7EA7;&#x522B;&#xFF0C;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x5728; Ring3 &#x7EA7;&#x522B;&#x65F6;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x6001;&#xFF0C;&#x6307;&#x4EE4;&#x53EA;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF0C;&#x800C;&#x8FD0;&#x884C;&#x5728; Ring0 &#x7EA7;&#x522B;&#x65F6;&#x88AB;&#x79F0;&#x4E3A;&#x8FD0;&#x884C;&#x5728;&#x5185;&#x6838;&#x6001;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/11.jpg" alt="image-20220512122211805"></p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;Java&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6700;&#x7EC8;&#x662F;&#x8981;&#x4EA4;&#x7ED9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6765;&#x4E3A;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x800C;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x5185;&#x6838;&#x5728;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x7A0B;&#x5E8F;&#x5728;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x5904;&#x4E8E;&#x4E86;&#x5185;&#x6838;&#x6001;&#xFF0C;&#x800C;&#x5F53;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x5206;&#x914D;&#x5B8C;&#x6210;&#xFF0C;&#x6700;&#x540E;&#x5230;&#x6211;&#x4EEC;Java&#x4EE3;&#x7801;&#x4E2D;&#x8FD4;&#x56DE;&#x5F97;&#x5230;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x53C8;&#x7EE7;&#x7EED;&#x7531;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;&#x5185;&#x6838;&#x6001;&#x8F6C;&#x6362;&#x56DE;&#x4E86;&#x7528;&#x6237;&#x6001;&#x3002;</p><p>&#x800C;&#x6211;&#x4EEC;&#x7684;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x4E5F;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x662F;&#x9700;&#x8981;&#x8BA9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x4ECE;&#x78C1;&#x76D8;&#x4E0A;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x6570;&#x636E;&#x6216;&#x662F;&#x5411;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;IO&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x4ECE;&#x78C1;&#x76D8;&#x4E0A;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x7136;&#x540E;&#x53D1;&#x9001;&#x5230;&#x7F51;&#x7EDC;&#x4E0A;&#xFF0C;&#x5C31;&#x4F1A;&#x7ECF;&#x5386;&#x4EE5;&#x4E0B;&#x6D41;&#x7A0B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/12.jpg" alt="image-20220512123113806"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x7ECF;&#x5386;&#x4E86;2&#x6B21;CPU&#x62F7;&#x8D1D;+2&#x6B21;DMA&#x62F7;&#x8D1D;&#xFF0C;&#x4E00;&#x5171;&#x56DB;&#x6B21;&#x62F7;&#x8D1D;&#xFF0C;&#x867D;&#x7136;&#x903B;&#x8F91;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x8001;&#x662F;&#x8FD9;&#x6837;&#x6765;&#x56DE;&#x8FDB;&#x884C;&#x590D;&#x5236;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x592A;&#x6D6A;&#x8D39;&#x65F6;&#x95F4;&#x4E86;&#x70B9;&#xFF1F;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x4E00;&#x79CD;&#x66F4;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x96F6;&#x62F7;&#x8D1D;&#x3002;</p><p>&#x5B9E;&#x73B0;&#x96F6;&#x62F7;&#x8D1D;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x6F14;&#x793A;&#x4E09;&#x79CD;&#x65B9;&#x6848;&#xFF1A;</p><ol><li><p>&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x5185;&#x5B58;</p><p>&#x73B0;&#x5728;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x652F;&#x6301;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x76F4;&#x63A5;&#x5171;&#x7528;&#x4E86;&#x8FD9;&#x4E00;&#x5757;&#x533A;&#x57DF;&#xFF0C;&#x4E5F;&#x5C31;&#x8C08;&#x4E0D;&#x4E0A;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#x4E86;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/13.jpg" alt="image-20220512124512936"></p></li><li><p>&#x4F7F;&#x7528;mmap/write&#x5185;&#x5B58;&#x6620;&#x5C04;</p><p>&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x5C06;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x7F13;&#x5B58;&#x76F4;&#x63A5;&#x6620;&#x5C04;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7F13;&#x5B58;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5728;&#x5B66;&#x4E60;NIO&#x4E2D;&#x4F7F;&#x7528;&#x7684;MappedByteBuffer&#xFF0C;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;&#x6620;&#x5C04;&#x5B58;&#x5728;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230;Socket&#x7F13;&#x51B2;&#x533A;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x4E2D;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x5C31;&#x884C;&#x4E86;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/14.jpg" alt="image-20220512124732995"></p><p>&#x4E0D;&#x8FC7;&#x8FD9;&#x6837;&#x8FD8;&#x662F;&#x4F1A;&#x51FA;&#x73B0;&#x7528;&#x6237;&#x6001;&#x548C;&#x5185;&#x6838;&#x6001;&#x7684;&#x5207;&#x6362;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x518D;&#x4F18;&#x5316;&#x4F18;&#x5316;&#x3002;</p></li><li><p>&#x4F7F;&#x7528;sendfile&#x65B9;&#x5F0F;</p><p>&#x5728;Linux2.1&#x5F00;&#x59CB;&#xFF0C;&#x5F15;&#x5165;&#x4E86;sendfile&#x65B9;&#x5F0F;&#x6765;&#x7B80;&#x5316;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x544A;&#x8BC9;&#x5185;&#x6838;&#x8981;&#x628A;&#x54EA;&#x4E2A;&#x6587;&#x4EF6;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x62F7;&#x8D1D;&#x5230;Socket&#x4E0A;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x4E2D;&#x4E00;&#x6B65;&#x5230;&#x4F4D;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/15.jpg" alt="image-20220512124950007"></p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5728;NIO&#x4E2D;&#x4F7F;&#x7528;&#x7684;<code>transferTo()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x5229;&#x7528;&#x4E86;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x6765;&#x5B9E;&#x73B0;&#x96F6;&#x62F7;&#x8D1D;&#x7684;&#x3002;</p></li></ol><h3 id="netty&#x5DE5;&#x4F5C;&#x6A21;&#x578B;"><a name="netty&#x5DE5;&#x4F5C;&#x6A21;&#x578B;" class="plugin-anchor" href="#netty&#x5DE5;&#x4F5C;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>Netty&#x5DE5;&#x4F5C;&#x6A21;&#x578B;</h3><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E86;Netty&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;&#x66F4;&#x9AD8;&#x7EA7;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;Netty&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF0C;&#x4E0A;&#x4E00;&#x7AE0;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;Reactor&#x6A21;&#x5F0F;&#xFF0C;&#x800C;Netty&#x6B63;&#x662F;&#x4EE5;&#x4E3B;&#x4ECE;Reactor&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x6784;&#x5EFA;&#x51FA;&#x4E86;&#x4E00;&#x5957;&#x9AD8;&#x6548;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;&#x3002;</p><p>&#x5927;&#x81F4;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/16.jpg" alt="image-20220509215109408"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x548C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x4ECB;&#x7ECD;&#x7684;&#x4E3B;&#x4ECE;Reactor&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/17.jpg" alt="image-20220505131410997"></p><p>&#x6240;&#x6709;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x5230;&#x4E3B;Reactor&#x5B8C;&#x6210;Accept&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;&#x7531;&#x4ECE;Reactor&#x53BB;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x91CC;&#x4E5F;&#x662F;&#x5DEE;&#x4E0D;&#x591A;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x4E9B;&#x6539;&#x8FDB;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x8BBE;&#x8BA1;&#xFF1A;</p><ul><li>Netty &#x62BD;&#x8C61;&#x51FA;&#x4E24;&#x7EC4;&#x7EBF;&#x7A0B;&#x6C60;BossGroup&#x548C;WorkerGroup&#xFF0C;BossGroup&#x4E13;&#x95E8;&#x8D1F;&#x8D23;&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;, WorkerGroup&#x4E13;&#x95E8;&#x8D1F;&#x8BFB;&#x5199;&#xFF0C;&#x5C31;&#x50CF;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8BF4;&#x7684;&#x4E3B;&#x4ECE;Reactor&#x4E00;&#x6837;&#x3002;</li><li>&#x65E0;&#x8BBA;&#x662F;BossGroup&#x8FD8;&#x662F;WorkerGroup&#xFF0C;&#x90FD;&#x662F;&#x4F7F;&#x7528;EventLoop&#xFF08;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#xFF0C;&#x5F88;&#x591A;&#x7CFB;&#x7EDF;&#x90FD;&#x91C7;&#x7528;&#x4E86;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x673A;&#x5236;&#xFF0C;&#x6BD4;&#x5982;&#x524D;&#x7AEF;&#x6846;&#x67B6;Node.js&#xFF0C;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x4E0D;&#x65AD;&#x5730;&#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x901A;&#x77E5;&#xFF09;&#x6765;&#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x7684;&#xFF0C;&#x6574;&#x4E2A;Netty&#x4E5F;&#x662F;&#x4F7F;&#x7528;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x6765;&#x8FD0;&#x4F5C;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x597D;&#x8BFB;&#x5199;&#x3001;&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x901A;&#x77E5;&#xFF0C;&#x8BF4;&#x767D;&#x4E86;&#x5C31;&#x50CF;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5199;NIO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x90A3;&#x6837;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6362;&#x6210;EventLoop&#x4E86;&#x800C;&#x5DF2;&#xFF0C;&#x5B83;&#x5DF2;&#x7ECF;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5C01;&#x88C5;&#x597D;&#x4E86;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;EventLoop&#xFF0C;&#x4F1A;&#x5B58;&#x653E;&#x5728;EventLoopGroup&#x4E2D;&#xFF0C;EventLoopGroup&#x5C31;&#x662F;BossGroup&#x548C;WorkerGroup&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</li><li>&#x5728;BossGroup&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6B63;&#x5E38;&#x5C06;SocketChannel&#x7ED1;&#x5B9A;&#x5230;WorkerGroup&#x4E2D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;EventLoop&#x4E0A;&#xFF0C;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x76D1;&#x542C;&#x3002;</li></ul><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x4E86;&#x89E3;&#x4E86;&#x4E00;&#x4E0B;Netty&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;&#xFF0C;&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x6765;&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Netty&#x670D;&#x52A1;&#x5668;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;NioEventLoopGroup&#x5B9E;&#x73B0;&#x7C7B;&#x5373;&#x53EF;&#xFF0C;&#x521B;&#x5EFA;BossGroup&#x548C;WorkerGroup</span>
    <span class="token comment">//&#x5F53;&#x7136;&#x8FD8;&#x6709;EpollEventLoopGroup&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x652F;&#x6301;Linux&#xFF0C;&#x8FD9;&#x662F;Netty&#x57FA;&#x4E8E;Linux&#x5E95;&#x5C42;Epoll&#x5355;&#x72EC;&#x7F16;&#x5199;&#x7684;&#x4E00;&#x5957;&#x672C;&#x5730;&#x5B9E;&#x73B0;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;NIO&#x90A3;&#x5957;</span>
    <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5F15;&#x5BFC;&#x7C7B;</span>
    <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x53EF;&#x94FE;&#x5F0F;&#xFF0C;&#x5C31;&#x5F88;&#x68D2;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>   <span class="token comment">//&#x6307;&#x5B9A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   <span class="token comment">//&#x6307;&#x5B9A;&#x4E3A;NIO&#x7684;ServerSocketChannel</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;SocketChannel&#x4E0D;&#x662F;&#x6211;&#x4EEC;NIO&#x91CC;&#x9762;&#x7684;&#xFF0C;&#x662F;Netty&#x7684;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//&#x83B7;&#x53D6;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x50CF;&#x6D41;&#x6C34;&#x7EBF;&#x4E00;&#x6837;&#x5728;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;Handler</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Handler&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;ChannelInboundHandlerAdapter</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//ctx&#x662F;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;msg&#x662F;&#x6536;&#x5230;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4EE5;ByteBuf&#x5F62;&#x5F0F;&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#xFF0C;&#x540E;&#x9762;&#x518D;&#x8BF4;&#xFF09;</span>
                            <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>   <span class="token comment">//&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E00;&#x4E0B;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x901A;&#x8FC7;&#x4E0A;&#x4E0B;&#x6587;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x6570;&#x636E;&#x56DE;&#x53BB;&#xFF0C;&#x6CE8;&#x610F;&#x8981;writeAndFlush&#x624D;&#x80FD;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x7ACB;&#x5373;&#x6536;&#x5230;</span>
                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x6700;&#x540E;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x542F;&#x52A8;</span>
    bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x9762;&#x5199;&#x4E86;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x4E00;&#x5B9A;&#x4F1A;&#x61F5;&#x903C;&#xFF0C;&#x8FD9;&#x4E9B;&#x65B0;&#x6765;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x8DDF;&#x4EC0;&#x4E48;&#x554A;&#xFF0C;&#x600E;&#x4E48;&#x4E00;&#x4E2A;&#x4E5F;&#x6CA1;&#x770B;&#x660E;&#x767D;&#xFF1F;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6682;&#x65F6;&#x5148;&#x5C06;&#x4EE3;&#x7801;&#x5199;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5404;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x8FD8;&#x8BF7;&#x542C;&#x540E;&#x9762;&#x7EC6;&#x7EC6;&#x9053;&#x6765;&#x3002;</p><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;SocketChannel&#xFF0C;&#x4E00;&#x4F1A;&#x901A;&#x8FC7;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x901A;&#x4FE1;</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x8FDE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x54B1;&#x7ED9;&#x5B83;&#x5957;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4E00;&#x76F4;&#x53D1;&#x6D88;&#x606F;&#x4E86;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8BF7;&#x8F93;&#x5165;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x5185;&#x5BB9;&#xFF1A;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x76F4;&#x63A5;&#x5411;&#x901A;&#x9053;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x771F;&#x8212;&#x670D;</span>
            channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x53D1;&#x9001;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x4ECE;&#x901A;&#x9053;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;</span>
            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#xFF1A;&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x901A;&#x8FC7;&#x901A;&#x9053;&#x6B63;&#x5E38;&#x6536;&#x53D1;&#x6570;&#x636E;&#x5373;&#x53EF;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x6210;&#x529F;&#x642D;&#x5EFA;&#x597D;&#x4E86;&#x4E00;&#x4E2A;Netty&#x670D;&#x52A1;&#x5668;&#x3002;</p><h3 id="channel&#x8BE6;&#x89E3;"><a name="channel&#x8BE6;&#x89E3;" class="plugin-anchor" href="#channel&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>Channel&#x8BE6;&#x89E3;</h3><p>&#x5728;&#x5B66;&#x4E60;NIO&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x5230;Channel&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x901A;&#x9053;&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x4F20;&#x8F93;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x9053;&#x652F;&#x6301;&#x53CC;&#x5411;&#x4F20;&#x8F93;&#x3002;</p><p>&#x800C;&#x5728;Netty&#x4E2D;&#xFF0C;&#x4E5F;&#x6709;&#x5BF9;&#x5E94;&#x7684;Channel&#x7C7B;&#x578B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Channel</span> <span class="token keyword">extends</span> <span class="token class-name">AttributeMap</span><span class="token punctuation">,</span> <span class="token class-name">ChannelOutboundInvoker</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">ChannelId</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x9053;ID</span>
    <span class="token class-name">EventLoop</span> <span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x83B7;&#x53D6;&#x6B64;&#x901A;&#x9053;&#x6240;&#x5C5E;&#x7684;EventLoop&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A;Channel&#x5728;&#x5B83;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x53EA;&#x80FD;&#x6CE8;&#x518C;&#x5230;&#x4E00;&#x4E2A;EventLoop&#x4E2D;</span>
    <span class="token class-name">Channel</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//Channel&#x662F;&#x5177;&#x6709;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x8FD4;&#x56DE;&#x7236;Channel</span>
    <span class="token class-name">ChannelConfig</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x9053;&#x5F53;&#x524D;&#x7684;&#x76F8;&#x5173;&#x72B6;&#x6001;</span>
    <span class="token keyword">boolean</span> <span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelMetadata</span> <span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x9053;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span>
    <span class="token class-name">SocketAddress</span> <span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">SocketAddress</span> <span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x5173;&#x95ED;&#x901A;&#x9053;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x7528;&#x5230;ChannelFuture&#xFF0C;&#x540E;&#x9762;&#x8BF4;</span>
    <span class="token keyword">boolean</span> <span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token function">bytesBeforeUnwritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token function">bytesBeforeWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Unsafe</span> <span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelPipeline</span> <span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x4E4B;&#x540E;&#x4E5F;&#x4F1A;&#x8BF4;</span>
    <span class="token class-name">ByteBufAllocator</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;Channel&#x62FF;&#x5230;ByteBufAllocator&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x6765;&#x5206;&#x914D;ByteBuf</span>
    <span class="token class-name">Channel</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Channel</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5237;&#x65B0;&#xFF0C;&#x57FA;&#x64CD;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;Netty&#x4E2D;&#x7684;Channel&#x76F8;&#x6BD4;NIO&#x529F;&#x80FD;&#x5C31;&#x591A;&#x5F97;&#x591A;&#x4E86;&#x3002;Netty&#x4E2D;&#x7684;Channel&#x4E3B;&#x8981;&#x7279;&#x70B9;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li>&#x6240;&#x6709;&#x7684;IO&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x8FD0;&#x884C;&#xFF0C;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E86;&#xFF0C;&#x90A3;&#x600E;&#x4E48;&#x83B7;&#x53D6;&#x64CD;&#x4F5C;&#x7684;&#x7ED3;&#x679C;&#x5462;&#xFF1F;&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x5728;&#x524D;&#x9762;JUC&#x7BC7;&#x6559;&#x7A0B;&#x4E2D;&#x5B66;&#x4E60;&#x7684;Future&#x5417;&#xFF0C;&#x6CA1;&#x9519;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;ChannelFuture&#x4E5F;&#x662F;&#x5E72;&#x8FD9;&#x4E8B;&#x7684;&#x3002;</li></ul><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6765;&#x770B;&#x4E00;&#x4E0B;Channel&#x63A5;&#x53E3;&#x7684;&#x7236;&#x63A5;&#x53E3;ChannelOutboundInvoker&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x5B9A;&#x4E49;&#x4E86;&#x5927;&#x91CF;&#x7684;I/O&#x64CD;&#x4F5C;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelOutboundInvoker</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x901A;&#x9053;&#x51FA;&#x7AD9;&#x8C03;&#x7528;&#xFF08;&#x5305;&#x542B;&#x5927;&#x91CF;&#x7684;&#x7F51;&#x7EDC;&#x51FA;&#x7AD9;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x5199;&#xFF09;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Socket&#x7ED1;&#x5B9A;&#x3001;&#x8FDE;&#x63A5;&#x3001;&#x65AD;&#x5F00;&#x3001;&#x5173;&#x95ED;&#x7B49;&#x64CD;&#x4F5C;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">,</span> <span class="token class-name">SocketAddress</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">deregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x4E0B;&#x9762;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x8FD8;&#x6709;&#x9644;&#x5E26;ChannelPromise&#x7684;&#xFF0C;ChannelPromise&#x6211;&#x4EEC;&#x540E;&#x9762;&#x518D;&#x8BF4;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;ChannelFuture&#x7684;&#x589E;&#x5F3A;&#x7248;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> var1<span class="token punctuation">,</span> <span class="token class-name">SocketAddress</span> var2<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">deregister</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelOutboundInvoker</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ChannelFuture</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x662F;&#x8FD4;&#x56DE;&#x7684;ChannelFuture&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x7ED9;&#x7ED3;&#x679C;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelOutboundInvoker</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ChannelPromise</span> <span class="token function">newPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5176;&#x4ED6;&#x7684;&#x6682;&#x65F6;&#x4E0D;&#x63D0;</span>
    <span class="token class-name">ChannelProgressivePromise</span> <span class="token function">newProgressivePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">newSucceededFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">newFailedFuture</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelPromise</span> <span class="token function">voidPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x5F53;&#x7136;&#x5B83;&#x8FD8;&#x5B9E;&#x73B0;&#x4E86;AttributeMap&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x5B9E;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;Session&#x90A3;&#x79CD;&#x611F;&#x89C9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x4E4B;&#x7C7B;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AttributeMap</span> <span class="token punctuation">{</span>
    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Attribute</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">attr</span><span class="token punctuation">(</span><span class="token class-name">AttributeKey</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token function">hasAttr</span><span class="token punctuation">(</span><span class="token class-name">AttributeKey</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E86;Netty&#x5E95;&#x5C42;&#x7684;Channel&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;ChannelHandler&#xFF0C;&#x65E2;&#x7136;&#x73B0;&#x5728;&#x6709;&#x4E86;&#x901A;&#x9053;&#xFF0C;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x60C5;&#x653E;&#x5728;ChannelHandler&#x4E2D;&#xFF0C;ChannelHandler&#x5145;&#x5F53;&#x4E86;&#x6240;&#x6709;&#x5165;&#x7AD9;&#x548C;&#x51FA;&#x7AD9;&#x6570;&#x636E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x903B;&#x8F91;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;Reactor&#x6A21;&#x5F0F;&#x4E2D;&#x7684;Handler&#xFF0C;&#x5168;&#x9760;&#x5B83;&#x6765;&#x5904;&#x7406;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p><p>&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;ChannelHandler&#x5728;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x6574;&#x5957;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x4F1A;&#x4ECB;&#x7ECD;ChannelPipeline&#x3002;</p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E86;ChannelInboundHandlerAdapter&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B83;&#x662F;ChannelInboundHandler&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x91CD;&#x5199;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x95F4;&#x88AB;&#x8C03;&#x7528;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
          <span class="token comment">//ctx&#x662F;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;msg&#x662F;&#x6536;&#x5230;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x4EE5;ByteBuf&#x5F62;&#x5F0F;</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>   <span class="token comment">//&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E00;&#x4E0B;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x901A;&#x8FC7;&#x4E0A;&#x4E0B;&#x6587;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x6570;&#x636E;&#x56DE;&#x53BB;&#xFF0C;&#x6CE8;&#x610F;&#x8981;writeAndFlush&#x624D;&#x80FD;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x7ACB;&#x5373;&#x6536;&#x5230;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x6211;&#x4EEC;&#x5148;&#x4ECE;&#x9876;&#x5C42;&#x63A5;&#x53E3;&#x5F00;&#x59CB;&#x770B;&#x8D77;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelHandler</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x5F53;ChannelHandler&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x65F6;&#x8C03;&#x7528;</span>
    <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5F53;ChannelHandler&#x4ECE;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x79FB;&#x9664;&#x65F6;&#x8C03;&#x7528;</span>
    <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

    <span class="token comment">/** @deprecated &#x5DF2;&#x8FC7;&#x65F6;&#x90A3;&#x54B1;&#x5C31;&#x4E0D;&#x7BA1;&#x4E86; */</span>
    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Inherited</span>
    <span class="token annotation punctuation">@Documented</span>
    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Sharable</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x9876;&#x5C42;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x4E9B;&#x6D41;&#x6C34;&#x7EBF;&#x76F8;&#x5173;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x4E0B;&#x4E00;&#x7EA7;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">//ChannelInboundHandler&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x76F8;&#x5173;&#x4E8B;&#x4EF6;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelInboundHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelHandler</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x5F53;Channel&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x5230;&#x81EA;&#x5DF1;&#x7684;EventLoop&#x4E0A;&#x65F6;&#x8C03;&#x7528;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x8BF4;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;Channel&#x53EA;&#x4F1A;&#x6CE8;&#x518C;&#x5230;&#x4E00;&#x4E2A;EventLoop&#x4E0A;&#xFF0C;&#x6CE8;&#x518C;&#x5230;EventLoop&#x540E;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x4F1A;&#x5728;&#x53D1;&#x751F;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x65F6;&#x88AB;&#x901A;&#x77E5;&#x3002;</span>
    <span class="token keyword">void</span> <span class="token function">channelRegistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x4ECE;EventLoop&#x4E0A;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#x65F6;</span>
    <span class="token keyword">void</span> <span class="token function">channelUnregistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5F53;Channel&#x5DF2;&#x7ECF;&#x5904;&#x4E8E;&#x6D3B;&#x8DC3;&#x72B6;&#x6001;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x6B64;&#x65F6;Channel&#x5DF2;&#x7ECF;&#x8FDE;&#x63A5;/&#x7ED1;&#x5B9A;&#xFF0C;&#x5E76;&#x4E14;&#x5DF2;&#x7ECF;&#x5C31;&#x7EEA;</span>
    <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x8DDF;&#x4E0A;&#x9762;&#x76F8;&#x53CD;&#xFF0C;&#x4E0D;&#x518D;&#x6D3B;&#x8DC3;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x5728;&#x8FDE;&#x63A5;&#x5B83;&#x7684;&#x8FDC;&#x7A0B;&#x8282;&#x70B9;</span>
    <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5F53;&#x4ECE;Channel&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6570;&#x636E;&#x88AB;&#x81EA;&#x52A8;&#x5305;&#x88C5;&#x6210;&#x4E86;&#x4E00;&#x4E2A;Object&#xFF08;&#x9ED8;&#x8BA4;&#x662F;ByteBuf&#xFF09;</span>
    <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">,</span> <span class="token class-name">Object</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x4E0A;&#x4E00;&#x4E2A;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x8C03;&#x7528;</span>
    <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x6682;&#x65F6;&#x4E0D;&#x4ECB;&#x7ECD;</span>
    <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">,</span> <span class="token class-name">Object</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5F53;Channel&#x7684;&#x53EF;&#x5199;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#x88AB;&#x8C03;&#x7528;</span>
    <span class="token keyword">void</span> <span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#x88AB;&#x8C03;&#x7528;</span>
    <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> var1<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x800C;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x7528;&#x5230;&#x7684;ChannelInboundHandlerAdapter&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5BF9;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x76F8;&#x6BD4;&#x76F4;&#x63A5;&#x7528;&#x63A5;&#x53E3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53EA;&#x91CD;&#x5199;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6CA1;&#x6709;&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;&#x4F1A;&#x9ED8;&#x8BA4;&#x5411;&#x6D41;&#x6C34;&#x7EBF;&#x4E0B;&#x4E00;&#x4E2A;ChannelHandler&#x53D1;&#x9001;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6765;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x5427;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestChannelHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRegistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelRegistered&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelUnregistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelUnregistered&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelActive&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelInactive&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x5C31;&#x76F4;&#x63A5;&#x4F7F;&#x7528;ctx.alloc()&#x6765;&#x751F;&#x6210;&#x7F13;&#x51B2;&#x533A;</span>
        <span class="token class-name">ByteBuf</span> back <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        back<span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>back<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelRead&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelReadComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;userEventTriggered&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelWritabilityChanged&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;exceptionCaught&quot;</span><span class="token operator">+</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                  <span class="token comment">//ChannelInitializer&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;ChannelHandler&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x4E0D;&#x5904;&#x7406;&#x4EFB;&#x4F55;&#x51FA;&#x7AD9;/&#x5165;&#x7AD9;&#x4E8B;&#x4EF6;&#xFF0C;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x4EC5;&#x4EC5;&#x662F;&#x5B8C;&#x6210;Channel&#x7684;&#x521D;&#x59CB;&#x5316;</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//&#x5C06;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;ChannelHandler&#x6DFB;&#x52A0;&#x5230;&#x6D41;&#x6C34;&#x7EBF;</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestChannelHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8FDE;&#x63A5;&#x5E76;&#x53D1;&#x9001;&#x4E00;&#x4E0B;&#x6570;&#x636E;&#x8BD5;&#x8BD5;&#x770B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/18.jpg" alt="image-20220510092703319"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;ChannelInboundHandler&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x9996;&#x5148;&#x662F;Channel&#x6CE8;&#x518C;&#x6210;&#x529F;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x4F1A;&#x53D8;&#x6210;&#x53EF;&#x7528;&#x72B6;&#x6001;&#xFF0C;&#x63A5;&#x7740;&#x5C31;&#x5DEE;&#x4E0D;&#x591A;&#x53EF;&#x4EE5;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x6570;&#x636E;&#x4E86;&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x4E3B;&#x52A8;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x4F1A;&#x518D;&#x6B21;&#x89E6;&#x53D1;&#x4E00;&#x6B21;<code>channelReadComplete</code>&#xFF0C;&#x7136;&#x540E;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x6700;&#x540E;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#x3002;</p><p>&#x6211;&#x4EEC;&#x6765;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x5462;&#xFF1F;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ByteBuf</span> back <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    back<span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>back<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelRead&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x5F02;&#x5E38;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x5F04;&#x70B9;&#x5F02;&#x5E38;&#x4E0A;&#x53BB;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelReadComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x5F02;&#x5E38;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5F04;&#x70B9;&#x5F02;&#x5E38;&#x4E0A;&#x53BB;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;exceptionCaught&quot;</span><span class="token operator">+</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x4F1A;&#x63A5;&#x7740;&#x8C03;&#x7528;<code>exceptionCaught</code>&#x65B9;&#x6CD5;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/19.jpg" alt="image-20220510094007913"></p><p>&#x4E0E;ChannelInboundHandler&#x5BF9;&#x5E94;&#x7684;&#x8FD8;&#x6709;ChannelOutboundHandler&#x7528;&#x4E8E;&#x5904;&#x7406;&#x51FA;&#x7AD9;&#x76F8;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8FDB;&#x884C;&#x6F14;&#x793A;&#x4E86;&#x3002;</p><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;ChannelPipeline&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Channel&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;ChannelPipeline&#xFF08;&#x5728;Channel&#x521D;&#x59CB;&#x5316;&#x65F6;&#x5C31;&#x88AB;&#x521B;&#x5EFA;&#x4E86;&#xFF09;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/20.jpg" alt="image-20220511152035030"></p><p>&#x5B83;&#x5C31;&#x50CF;&#x662F;&#x4E00;&#x6761;&#x6D41;&#x6C34;&#x7EBF;&#x4E00;&#x6837;&#xFF0C;&#x6574;&#x6761;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x4E2A;Handler&#xFF08;&#x5305;&#x62EC;&#x5165;&#x7AD9;&#x548C;&#x51FA;&#x7AD9;&#xFF09;&#xFF0C;&#x6574;&#x6761;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x7684;&#x4E24;&#x7AEF;&#x8FD8;&#x6709;&#x4E24;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x5668;&#xFF08;&#x7528;&#x4E8E;&#x4E00;&#x4E9B;&#x9884;&#x7F6E;&#x64CD;&#x4F5C;&#x548C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x7B49;&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x5982;&#x4F55;&#x5B89;&#x6392;&#x8FD9;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Handler&#x5373;&#x53EF;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5E0C;&#x671B;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x5165;&#x7AD9;ChannelHandler&#xFF0C;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x5E76;&#x5904;&#x7406;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5F53;&#x524D;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;SocketChannel&#x4E0D;&#x662F;&#x6211;&#x4EEC;NIO&#x91CC;&#x9762;&#x7684;&#xFF0C;&#x662F;Netty&#x7684;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x83B7;&#x53D6;pipeline&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;Handler&#xFF0C;&#x6CE8;&#x610F;&#x987A;&#x5E8F;</span>
                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x6D88;&#x606F;&#x63A5;&#x6536;</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x5F02;&#x5E38;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//&#x7B2C;&#x4E8C;&#x4E2A;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5F02;&#x5E38;</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x5F02;&#x5E38;&#x5904;&#x7406;&#xFF1A;&quot;</span><span class="token operator">+</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x90A3;&#x4E48;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x8FD0;&#x4F5C;&#x7684;&#x5462;&#xFF1F;&#x5B9E;&#x9645;&#x4E0A;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x5728;ChannelInboundHandlerAdapter&#x4E2D;&#x91CD;&#x5199;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4F1A;&#x9ED8;&#x8BA4;&#x4F20;&#x64AD;&#x5230;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;ChannelInboundHandlerAdapter&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x8FC7;ChannelHandlerContext&#x6765;&#x5411;&#x4E0B;&#x4F20;&#x9012;&#xFF0C;ChannelHandlerContext&#x662F;&#x5728;Handler&#x6DFB;&#x52A0;&#x8FDB;Pipeline&#x4E2D;&#x65F6;&#x5C31;&#x88AB;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x7684;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x9700;&#x8981;&#x5C06;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5728;&#x4E24;&#x4E2A;Handler&#x4E2D;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x83B7;&#x53D6;pipeline&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;Handler</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x8FC7;ChannelHandlerContext</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;&#x51FA;&#x7AD9;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ChannelOutboundHandlerAdapter&#x6765;&#x5B8C;&#x6210;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   
              <span class="token comment">//&#x6CE8;&#x610F;&#x51FA;&#x6808;&#x7AD9;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x5728;&#x5165;&#x7AD9;&#x64CD;&#x4F5C;&#x7684;&#x524D;&#x9762;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;ChannelHandlerContext&#x7684;write&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x662F;&#x4ECE;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x5012;&#x7740;&#x5F80;&#x524D;&#x627E;&#x4E0B;&#x4E00;&#x4E2A;ChannelOutboundHandlerAdapter&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x4F7F;&#x7528;&#x7684;ChannelInboundHandlerAdapter&#x662F;&#x4ECE;&#x524D;&#x5F80;&#x540E;&#x627E;&#x4E0B;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;Channel&#x7684;write&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x4ECE;&#x6574;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x6700;&#x540E;&#x5F00;&#x59CB;&#x5012;&#x7740;&#x5F80;&#x524D;&#x627E;ChannelOutboundHandlerAdapter&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x987A;&#x5E8F;&#x3002;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  <span class="token comment">//&#x5F53;&#x6267;&#x884C;write&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4F1A;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//write&#x7684;&#x662F;&#x5565;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x662F;&#x5565;</span>
                      <span class="token comment">//&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;ByteBuf&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x53D1;&#x9001;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4E0D;&#x4F1A;&#x5427;&#x4E0D;&#x4F1A;&#x5427;&#xFF0C;&#x4E0D;&#x4F1A;&#x8FD8;&#x6709;&#x4EBA;&#x90FD;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#x8FD8;&#x6CA1;&#x4E09;&#x8FDE;&#x5427;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;write&#x4EFB;&#x4F55;&#x5BF9;&#x8C61;</span>
                      <span class="token comment">//ctx.channel().writeAndFlush(&quot;&#x554A;&#x5BF9;&#x5BF9;&#x5BF9;&quot;); &#x6216;&#x662F;&#x901A;&#x8FC7;Channel&#x8FDB;&#x884C;write&#x4E5F;&#x53EF;&#x4EE5;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x8BD5;&#x8BD5;&#x770B;&#xFF0C;&#x641E;&#x4E24;&#x4E2A;&#x51FA;&#x7AD9;&#x7684;Handler&#xFF0C;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x6837;&#x5B50;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x83B7;&#x53D6;pipeline&#xFF0C;&#x7136;&#x540E;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;Handler</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4F1E;&#x5175;&#x4E00;&#x53F7;&#x5362;&#x672C;&#x4F1F;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;channel&#x7684;write</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&#x53F7;&#x51FA;&#x7AD9;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&#x53F7;&#x51FA;&#x7AD9;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7EE7;&#x7EED;write&#x7ED9;&#x5176;&#x4ED6;&#x7684;&#x51FA;&#x7AD9;Handler&#xFF0C;&#x4E0D;&#x7136;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x65AD;&#x4E86;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6240;&#x4EE5;&#xFF0C;&#x51FA;&#x7AD9;&#x64CD;&#x4F5C;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x662F;&#x53CD;&#x7740;&#x6765;&#x7684;&#xFF0C;&#x6574;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#x64CD;&#x4F5C;&#x5927;&#x6982;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;:</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/21.jpg" alt="image-20220510130021714"></p><p>&#x6709;&#x5173;Channel&#x53CA;&#x5176;&#x5904;&#x7406;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x5148;&#x8BB2;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p><h3 id="eventloop&#x548C;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;"><a name="eventloop&#x548C;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;" class="plugin-anchor" href="#eventloop&#x548C;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;"><i class="fa fa-link" aria-hidden="true"></i></a>EventLoop&#x548C;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;</h3><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x8BB2;&#x89E3;&#x4E86;Channel&#xFF0C;&#x90A3;&#x4E48;&#x5728;EventLoop&#x4E2D;&#x5177;&#x4F53;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x7684;&#x5462;&#xFF1F;&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5728;&#x7F16;&#x5199;NIO&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;while&#x5FAA;&#x73AF;&#x5728;&#x6E90;&#x6E90;&#x4E0D;&#x65AD;&#x5730;&#x7B49;&#x5F85;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x800C;EventLoop&#x4E5F;&#x6B63;&#x662F;&#x8FD9;&#x79CD;&#x601D;&#x60F3;&#xFF0C;&#x5B83;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x7B49;&#x5F85;/&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x3002;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/22.jpg" alt="image-20220510133359757"></p><p>&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;EventLoopGroup&#xFF0C;&#x5305;&#x542B;&#x5F88;&#x591A;&#x4E2A;EventLoop&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x7ED1;&#x5B9A;&#x5230;&#x4E00;&#x4E2A;EventLoop&#x4E0A;&#xFF0C;&#x4E4B;&#x540E;EventLoop&#x5C31;&#x4F1A;&#x5F00;&#x59CB;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#xFF08;&#x53EA;&#x8981;&#x8FDE;&#x63A5;&#x4E0D;&#x5173;&#x95ED;&#xFF0C;&#x4E00;&#x76F4;&#x90FD;&#x662F;&#x8FD9;&#x4E2A;EventLoop&#x8D1F;&#x8D23;&#x6B64;Channel&#xFF09;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;EventLoop&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x76D1;&#x542C;&#x5F88;&#x591A;&#x4E2A;Channel&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5B66;&#x4E60;&#x7684;Selector&#x7F62;&#x4E86;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;EventLoop&#x5E76;&#x4E0D;&#x53EA;&#x662F;&#x7528;&#x4E8E;&#x7F51;&#x7EDC;&#x64CD;&#x4F5C;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;EventLoop&#x5176;&#x5B9E;&#x90FD;&#x662F;NioEventLoop&#xFF0C;&#x5B83;&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x666E;&#x901A;&#x7684;EventLoop&#x6765;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</p><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7F16;&#x5199;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x867D;&#x7136;&#x7ED3;&#x6784;&#x4E0A;&#x548C;&#x4E3B;&#x4ECE;Reactor&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;Handler&#x4F3C;&#x4E4E;&#x662F;&#x548C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5728;&#x4E00;&#x8D77;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x6240;&#x8BF4;&#x7684;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;Handler&#x662F;&#x5728;&#x8BFB;&#x5199;&#x4E4B;&#x5916;&#x7684;&#x5355;&#x72EC;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7EBF;&#x7A0B;&#x6570;&#x5148;&#x9650;&#x5236;&#x4E00;&#x4E0B;</span>
    <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>   <span class="token comment">//&#x6307;&#x5B9A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   <span class="token comment">//&#x6307;&#x5B9A;&#x4E3A;NIO&#x7684;ServerSocketChannel</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;SocketChannel&#x4E0D;&#x662F;&#x6211;&#x4EEC;NIO&#x91CC;&#x9762;&#x7684;&#xFF0C;&#x662F;Netty&#x7684;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5361;10&#x79D2;&#x5047;&#x88C5;&#x5728;&#x5904;&#x7406;&#x4EFB;&#x52A1;</span>
                                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x8FD9;&#x91CC;&#x5361;&#x4F4F;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x6CA1;&#x529E;&#x6CD5;&#x5904;&#x7406;EventLoop&#x7ED1;&#x5B9A;&#x7684;&#x5176;&#x4ED6;Channel&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;EventLoop&#x6765;&#x4E13;&#x95E8;&#x5904;&#x7406;&#x8BFB;&#x5199;&#x4E4B;&#x5916;&#x7684;&#x4EFB;&#x52A1;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7EBF;&#x7A0B;&#x6570;&#x5148;&#x9650;&#x5236;&#x4E00;&#x4E0B;</span>
    <span class="token class-name">EventLoopGroup</span> handlerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x4F7F;&#x7528;DefaultEventLoop&#x6765;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;</span>
    <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                                      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    handlerGroup<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>   
                                <span class="token comment">//&#x7531;&#x4E8E;&#x7EE7;&#x627F;&#x81EA;ScheduledExecutorService&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x8D3C;&#x65B9;&#x4FBF;</span>
                                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5199;&#x6210;&#x4E00;&#x6761;&#x6D41;&#x6C34;&#x7EBF;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7EBF;&#x7A0B;&#x6570;&#x5148;&#x9650;&#x5236;&#x4E00;&#x4E0B;</span>
    <span class="token class-name">EventLoopGroup</span> handlerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x4F7F;&#x7528;DefaultEventLoop&#x6765;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;</span>
    <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>handlerGroup<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//&#x5728;&#x6DFB;&#x52A0;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;EventLoopGroup</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8FDB;&#x4E00;&#x6B65;&#x5730;&#x5C06;EventLoop&#x5229;&#x7528;&#x8D77;&#x6765;&#x4E86;&#x3002;</p><p>&#x6309;&#x7167;&#x524D;&#x9762;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x628A;Netty&#x7248;&#x672C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x7ED9;&#x5199;&#x4E86;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x662F;&#x4F7F;&#x7528;Bootstrap&#x6765;&#x542F;&#x52A8;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x6CA1;&#x90A3;&#x4E48;&#x9EBB;&#x70E6;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x4E00;&#x4E2A;EventLoop&#x5C31;&#x884C;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x53D1;&#x56DE;&#x6765;&#x7684;&#x6570;&#x636E;</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x80AF;&#x5B9A;&#x5C31;&#x662F;&#x4F7F;&#x7528;SocketChannel&#x4E86;</span>
            <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x7684;&#x6570;&#x636E;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x662F;&#x4E00;&#x6837;&#x7684;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x8FDE;&#x63A5;&#x540E;&#x62FF;&#x5230;&#x5BF9;&#x5E94;&#x7684;Channel&#x5BF9;&#x8C61;</span>
      <span class="token comment">//&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x8FDE;&#x63A5;&#x64CD;&#x4F5C;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x4F1A;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x8D70;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x6B63;&#x5F0F;&#x7F16;&#x5199;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x53D1;&#x9001;&#x4EE3;&#x7801;&#x4E86;</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//&#x8FD8;&#x662F;&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#xFF0C;&#x626B;&#x4E86;&#x5C31;&#x53D1;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&lt; &#x8BF7;&#x8F93;&#x5165;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x5185;&#x5BB9;&#xFF1A;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x901A;&#x8FC7;Channel&#x5BF9;&#x8C61;&#x53D1;&#x9001;&#x6570;&#x636E;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x6765;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x5427;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/23.jpg" alt="image-20220510144513303"></p><h3 id="future&#x548C;promise"><a name="future&#x548C;promise" class="plugin-anchor" href="#future&#x548C;promise"><i class="fa fa-link" aria-hidden="true"></i></a>Future&#x548C;Promise</h3><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;ChannelFuture&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#xFF0C;Netty&#x4E2D;Channel&#x7684;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x7ACB;&#x5373;&#x5F97;&#x5230;&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5F97;&#x5230;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x5229;&#x7528;&#x5230;Future&#x3002;</p><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;ChannelFutuer&#x63A5;&#x53E3;&#x600E;&#x4E48;&#x5B9A;&#x4E49;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelFuture</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Channel</span> <span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x6B64;&#x4EFB;&#x52A1;&#x7684;Channel</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x5F53;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x65F6;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x6267;&#x884C;GenericFutureListener&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x6CE8;&#x610F;&#x6267;&#x884C;&#x7684;&#x4F4D;&#x7F6E;&#x4E5F;&#x662F;&#x5728;EventLoop&#x4E2D;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">addListeners</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">removeListeners</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x7B49;&#x5F85;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x4EFB;&#x52A1;&#x5931;&#x8D25;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">syncUninterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x540C;&#x4E0A;&#xFF0C;&#x4F46;&#x662F;&#x65E0;&#x6CD5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>  <span class="token comment">//&#x540C;&#x4E0A;&#xFF0C;&#x4F46;&#x662F;&#x4EFB;&#x52A1;&#x4E2D;&#x65AD;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5224;&#x65AD;</span>
    <span class="token class-name">ChannelFuture</span> <span class="token function">awaitUninterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x4E0D;&#x7528;&#x6211;&#x8BF4;&#x4E86;&#x5427;&#xFF1F;</span>
    <span class="token keyword">boolean</span> <span class="token function">isVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x4E3A;void</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6B64;&#x63A5;&#x53E3;&#x662F;&#x7EE7;&#x627F;&#x81EA;Netty&#x4E2D;&#x7684;Future&#x63A5;&#x53E3;&#x7684;&#xFF08;&#x4E0D;&#x662F;JDK&#x7684;&#x90A3;&#x4E2A;&#xFF09;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>   <span class="token comment">//&#x518D;&#x5F80;&#x4E0A;&#x624D;&#x662F;JDK&#x7684;Future</span>
    <span class="token keyword">boolean</span> <span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x4EFB;&#x52A1;&#x662F;&#x5426;&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;</span>
    <span class="token keyword">boolean</span> <span class="token function">isCancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Throwable</span> <span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x83B7;&#x53D6;&#x5BFC;&#x81F4;&#x4EFB;&#x52A1;&#x5931;&#x8D25;&#x7684;&#x5F02;&#x5E38;</span>

      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token class-name">V</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7ACB;&#x5373;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x672A;&#x4EA7;&#x751F;&#x7ED3;&#x679C;&#xFF0C;&#x5F97;&#x5230;null&#xFF0C;&#x4E0D;&#x8FC7;ChannelFuture&#x5B9A;&#x4E49;V&#x4E3A;Void&#xFF0C;&#x5C31;&#x7B97;&#x5B8C;&#x6210;&#x4E86;&#x83B7;&#x53D6;&#x4E5F;&#x662F;null</span>
    <span class="token keyword">boolean</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x53D6;&#x6D88;&#x4EFB;&#x52A1;</span>
<span class="token punctuation">}</span>
</code></pre><p>Channel&#x7684;&#x5F88;&#x591A;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;ChannelFuture&#xFF0C;&#x6BD4;&#x5982;Channel&#x7684;write&#x64CD;&#x4F5C;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;ChannelFuture&#x5BF9;&#x8C61;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x72B6;&#x6001;&#xFF1A;&quot;</span><span class="token operator">+</span>future<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x901A;&#x8FC7;ChannelFuture&#x6765;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x5305;&#x62EC;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x4E5F;&#x662F;&#x8FD4;&#x56DE;&#x7684;ChannelFuture&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x72B6;&#x6001;&#xFF1A;&quot;</span><span class="token operator">+</span>future<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x542F;&#x52A8;&#x5C31;&#x6BD4;&#x8F83;&#x6162;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x72B6;&#x6001;&#x4F1A;&#x8FD4;&#x56DE;<code>false</code>&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53C8;&#x9700;&#x8981;&#x7B49;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x60C5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6848;&#x4E86;&#xFF1A;</p><pre class="language-"><code class="lang-java">                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    future<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8BA9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x72B6;&#x6001;&#xFF1A;&quot;</span><span class="token operator">+</span>future<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;&#x662F;&#x76F4;&#x63A5;&#x8BA9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x7B49;&#x5F85;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>sync()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;&#x76F4;&#x5230;&#x4EFB;&#x52A1;&#x7ED3;&#x675F;&#x3002;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6848;&#x662F;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x65F6;&#x901A;&#x77E5;&#xFF1A;</p><pre class="language-"><code class="lang-java">                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x76F4;&#x63A5;&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5F53;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x65F6;&#x81EA;&#x52A8;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x6CE8;&#x610F;&#x6267;&#x884C;&#x4E5F;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4E0D;&#x662F;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;</span>
    future<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x5305;&#x62EC;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5173;&#x95ED;&#xFF0C;&#x4E5F;&#x662F;&#x5F02;&#x6B65;&#x8FDB;&#x884C;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&lt; &#x8BF7;&#x8F93;&#x5165;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x5185;&#x5BB9;&#xFF1A;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x8F93;&#x5165;exit&#x5C31;&#x9000;&#x51FA;</span>
            <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            future<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x7B49;&#x5F85;Channel&#x5B8C;&#x5168;&#x5173;&#x95ED;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4F18;&#x96C5;&#x9000;&#x51FA;EventLoop&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x628A;&#x8FD8;&#x6CA1;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x60C5;&#x505A;&#x5B8C;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;shutdownNow&#x7ACB;&#x5373;&#x5173;&#x95ED;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;Promise&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x624B;&#x52A8;&#x8BBE;&#x5B9A;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">//&#x6B64;&#x63A5;&#x53E3;&#x4E5F;&#x662F;&#x7EE7;&#x627F;&#x81EA;Netty&#x4E2D;&#x7684;Future&#x63A5;&#x53E3;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token class-name">V</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x624B;&#x52A8;&#x8BBE;&#x5B9A;&#x6210;&#x529F;</span>
    <span class="token keyword">boolean</span> <span class="token function">trySuccess</span><span class="token punctuation">(</span><span class="token class-name">V</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">setFailure</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x624B;&#x52A8;&#x8BBE;&#x5B9A;&#x5931;&#x8D25;</span>
    <span class="token keyword">boolean</span> <span class="token function">tryFailure</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">setUncancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x8FD9;&#x4E9B;&#x5C31;&#x548C;&#x4E4B;&#x524D;&#x7684;Future&#x662F;&#x4E00;&#x6837;&#x7684;&#x4E86;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">addListeners</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">removeListeners</span><span class="token punctuation">(</span><span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">awaitUninterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">syncUninterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x6765;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x80AF;&#x5B9A;&#x4E0D;&#x662F;&#x6210;&#x529F;&#x7684;</span>
    promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token string">&quot;lbwnb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x8BBE;&#x5B9A;&#x6210;&#x529F;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x518D;&#x6B21;&#x83B7;&#x53D6;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x6210;&#x529F;&#x4E86;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x7ED9;&#x8FDB;&#x53BB;&#x7684;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x6210;&#x529F;&#x72B6;&#x6001;&#xFF0C;&#x5305;&#x62EC;ChannelOutboundInvoker&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x662F;&#x652F;&#x6301;ChannelPromise&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelPromise</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultChannelPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        promise<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x540C;&#x6B65;&#x7B49;&#x5F85;&#x4E00;&#x4E0B;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x6700;&#x540E;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x4E86;&#xFF0C;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x50CF;Future&#x90A3;&#x6837;&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5F53;&#x6210;&#x529F;&#x65F6;&#x81EA;&#x52A8;&#x901A;&#x77E5;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    promise<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x6CE8;&#x610F;&#x662F;&#x5728;&#x4E0A;&#x9762;&#x7684;DefaultEventLoop&#x6267;&#x884C;&#x7684;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token string">&quot;lbwnb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6709;&#x5173;Future&#x548C;Promise&#x5C31;&#x6682;&#x65F6;&#x8BB2;&#x89E3;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p><h3 id="&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;"><a name="&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;" class="plugin-anchor" href="#&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;</h3><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x4E86;Netty&#x7684;&#x5927;&#x90E8;&#x5206;&#x57FA;&#x7840;&#x5185;&#x5BB9;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;Netty&#x5185;&#x7F6E;&#x7684;&#x4E00;&#x4E9B;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#x3002;</p><p>&#x5728;&#x524D;&#x9762;&#x7684;&#x5B66;&#x4E60;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x90FD;&#x662F;&#x9700;&#x8981;&#x4EE5;ByteBuf&#x5F62;&#x5F0F;&#x4F20;&#x8F93;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x592A;&#x4E0D;&#x65B9;&#x4FBF;&#x4E86;&#xFF0C;&#x54B1;&#x4EEC;&#x80FD;&#x4E0D;&#x80FD;&#x53C2;&#x8003;&#x4E00;&#x4E0B;JavaWeb&#x90A3;&#x79CD;&#x641E;&#x4E2A;Filter&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5904;&#x7406;&#x6570;&#x636E;&#x4E4B;&#x524D;&#xFF0C;&#x8FC7;&#x8FC7;&#x6EE4;&#x4E00;&#x6B21;&#xFF0C;&#x5E76;&#x5728;&#x8FC7;&#x6EE4;&#x7684;&#x9014;&#x4E2D;&#x5C06;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x53D1;&#x51FA;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF0C;&#x8FD9;&#x5C31;&#x8981;&#x7528;&#x5230;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;&#x4E86;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x6700;&#x7B80;&#x7684;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x76F4;&#x63A5;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x5904;&#x7406;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x7801;&#x5668;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//&#x89E3;&#x7801;&#x5668;&#x672C;&#x8D28;&#x4E0A;&#x4E5F;&#x7B97;&#x662F;&#x4E00;&#x79CD;ChannelInboundHandlerAdapter&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x8BF7;&#x6C42;</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6765;&#x7684;&#x6570;&#x636E;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x7684;ByteBuf&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5185;&#x7F6E;&#x7684;StringDecoder&#x5373;&#x53EF;&#x8F6C;&#x6362;</span>
            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token comment">//&#x7ECF;&#x8FC7;StringDecoder&#x8F6C;&#x6362;&#x540E;&#xFF0C;msg&#x76F4;&#x63A5;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6240;&#x4EE5;&#x6253;&#x5370;&#x5C31;&#x884C;&#x4E86;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FD8;&#x662F;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;&#x6D41;&#x6C34;&#x7EBF;&#x5373;&#x53EF;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5668;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;ChannelInboundHandlerAdapter&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/24.jpg" alt="image-20220511123807650"></p><p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5B83;&#x662F;&#x7EE7;&#x627F;&#x81EA;MessageToMessageDecoder&#xFF0C;&#x7528;&#x4E8E;&#x5C06;&#x4F20;&#x5165;&#x7684;Message&#x8F6C;&#x6362;&#x4E3A;&#x53E6;&#x4E00;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">/**
 * &#x6211;&#x4EEC;&#x4E5F;&#x6765;&#x641E;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageDecoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> buf<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6570;&#x636E;&#x5DF2;&#x6536;&#x5230;&#xFF0C;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x89E3;&#x7801;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x4E3A;UTF8&#x5B57;&#x7B26;&#x4E32;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x89E3;&#x7801;&#x540E;&#x9700;&#x8981;&#x5C06;&#x89E3;&#x6790;&#x540E;&#x7684;&#x6570;&#x636E;&#x4E22;&#x8FDB;List&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4E22;&#x8FDB;&#x53BB;&#x591A;&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6570;&#x636E;&#x88AB;&#x5206;&#x6210;&#x4E86;&#x591A;&#x4E2A;&#xFF0C;&#x540E;&#x9762;&#x7684;Handler&#x5C31;&#x9700;&#x8981;&#x6BCF;&#x4E2A;&#x90FD;&#x5904;&#x7406;&#x4E00;&#x6B21;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FD0;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/25.jpg" alt="image-20220511124755974"></p><p>&#x5F53;&#x7136;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;List&#x91CC;&#x9762;&#x4E22;&#x5F88;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x7684;&#x8BDD;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageDecoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> buf<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6570;&#x636E;&#x5DF2;&#x6536;&#x5230;&#xFF0C;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x89E3;&#x7801;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x4E3A;UTF8&#x5B57;&#x7B26;&#x4E32;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token operator">+</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token operator">+</span><span class="token char">&apos;3&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4E00;&#x6761;&#x6D88;&#x606F;&#x88AB;&#x89E3;&#x7801;&#x6210;&#x4E09;&#x6761;&#x6D88;&#x606F;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/26.jpg" alt="image-20220511124933026"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x540E;&#x9762;&#x7684;Handler&#x4F1A;&#x4F9D;&#x6B21;&#x5BF9;&#x4E09;&#x6761;&#x6570;&#x636E;&#x90FD;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x9664;&#x4E86;MessageToMessageDecoder&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x89E3;&#x7801;&#x5668;&#xFF0C;&#x6BD4;&#x5982;ByteToMessageDecoder&#x7B49;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;Netty&#x5185;&#x7F6E;&#x4E86;&#x5F88;&#x591A;&#x7684;&#x89E3;&#x7801;&#x5668;&#x5B9E;&#x73B0;&#x6765;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#xFF0C;&#x6BD4;&#x5982;HTTP&#xFF08;&#x4E0B;&#x4E00;&#x8282;&#x4ECB;&#x7ECD;&#xFF09;&#xFF0C;SMTP&#x3001;MQTT&#x7B49;&#xFF0C;&#x4EE5;&#x53CA;&#x6211;&#x4EEC;&#x5E38;&#x7528;&#x7684;Redis&#x3001;Memcached&#x3001;JSON&#x7B49;&#x6570;&#x636E;&#x5305;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x6709;&#x4E86;&#x89E3;&#x7801;&#x5668;&#x5904;&#x7406;&#x53D1;&#x6765;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x53D1;&#x51FA;&#x53BB;&#x7684;&#x6570;&#x636E;&#x80AF;&#x5B9A;&#x4E5F;&#x662F;&#x9700;&#x8981;&#x88AB;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x7F16;&#x7801;&#x5668;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//&#x89E3;&#x7801;&#x5668;&#x672C;&#x8D28;&#x4E0A;&#x4E5F;&#x7B97;&#x662F;&#x4E00;&#x79CD;ChannelInboundHandlerAdapter&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x8BF7;&#x6C42;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;&#x53EF;&#x4EE5;&#xFF0C;&#x4E0D;&#x8DDF;&#x4F60;&#x591A;BB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x53D1;&#x5B57;&#x7B26;&#x4E32;&#x56DE;&#x53BB;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x4F7F;&#x7528;&#x5185;&#x7F6E;&#x7684;StringEncoder&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;&#x51FA;&#x7AD9;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x636E;&#x7F16;&#x7801;&#x6210;ByteBuf</span>
</code></pre><p>&#x548C;&#x4E0A;&#x9762;&#x7684;StringDecoder&#x4E00;&#x6837;&#xFF0C;StringEncoder&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;ChannelOutboundHandlerAdapter&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/27.jpg" alt="image-20220511130100984"></p><p>&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x524D;&#x9762;&#x5B66;&#x4E60;&#x7684;Handler&#x548C;Pipeline&#x7A81;&#x7136;&#x5C31;&#x53D8;&#x5F97;&#x6709;&#x7528;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x4E00;&#x6761;&#x7EBF;&#x628A;&#x6570;&#x636E;&#x5904;&#x7406;&#x5B89;&#x6392;&#x5F97;&#x660E;&#x660E;&#x767D;&#x767D;&#x554A;&#x3002;</p><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x628A;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x6539;&#x6210;&#x4F7F;&#x7528;&#x7F16;&#x7801;&#x3001;&#x89E3;&#x7801;&#x5668;&#x7684;&#x6837;&#x5B50;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bootstrap
            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//&#x89E3;&#x7801;&#x5668;&#x5B89;&#x6392;</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x63A5;&#x6536;&#x5B57;&#x7B26;&#x4E32;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x7F16;&#x7801;&#x5668;&#x5B89;&#x6392;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&lt; &#x8BF7;&#x8F93;&#x5165;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x5185;&#x5BB9;&#xFF1A;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x5B57;&#x7B26;&#x4E32;&#x5C31;&#x884C;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x53C8;&#x8E6D;&#x8E6D;&#x7684;&#x51CF;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/28.jpg" alt="image-20220511130605337"></p><p>&#x5F53;&#x7136;&#xFF0C;&#x9664;&#x4E86;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x7F16;&#x89E3;&#x7801;&#x5668;&#x3002;&#xFF1F;&#xFF1F;&#x7F1D;&#x5408;&#x602A;&#xFF1F;&#xFF1F;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/29.jpg" alt="image-20220511130937624"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B83;&#x662F;&#x65E2;&#x7EE7;&#x627F;&#x4E86;ChannelInboundHandlerAdapter&#x4E5F;&#x5B9E;&#x73B0;&#x4E86;ChannelOutboundHandler&#x63A5;&#x53E3;&#xFF0C;&#x53C8;&#x80FD;&#x5904;&#x7406;&#x51FA;&#x7AD9;&#x4E5F;&#x80FD;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x8BF7;&#x6C42;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5C06;&#x4E4B;&#x524D;&#x7684;&#x7ED9;&#x7EC4;&#x5408;&#x5230;&#x4E00;&#x8D77;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7F1D;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x7684;StringCodec&#x7C7B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">//&#x9700;&#x8981;&#x6307;&#x5B9A;&#x4E24;&#x4E2A;&#x6CDB;&#x578B;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x5165;&#x7AD9;&#x7684;&#x6D88;&#x606F;&#x7C7B;&#x578B;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x662F;&#x51FA;&#x7AD9;&#x7684;&#x6D88;&#x606F;&#x7C7B;&#x578B;&#xFF0C;&#x51FA;&#x7AD9;&#x662F;String&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x8F6C;&#x6210;ByteBuf</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringCodec</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageCodec</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">String</span> buf<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6B63;&#x5728;&#x5904;&#x7406;&#x51FA;&#x7AD9;&#x6570;&#x636E;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x540C;&#x6837;&#x7684;&#xFF0C;&#x6DFB;&#x52A0;&#x7684;&#x6570;&#x91CF;&#x5C31;&#x662F;&#x51FA;&#x7AD9;&#x7684;&#x6D88;&#x606F;&#x6570;&#x91CF;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> buf<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6B63;&#x5728;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x6570;&#x636E;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#xFF0C;&#x76F4;&#x63A5;&#x4E00;&#x884C;&#x89E3;&#x51B3;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x540C;&#x65F6;&#x53BB;&#x5B9E;&#x73B0;&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x65B9;&#x6CD5;&#xFF0C;&#x7EE7;&#x627F;MessageToMessageCodec&#x7C7B;&#x5373;&#x53EF;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x6574;&#x6761;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x4E2A;&#x89E3;&#x7801;&#x5668;&#x6216;&#x662F;&#x7F16;&#x7801;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x53EF;&#x4EE5;&#x591A;&#x6B21;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x6216;&#x662F;&#x89E3;&#x7801;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringToStringEncoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageEncoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6211;&#x662F;&#x9884;&#x5904;&#x7406;&#x7F16;&#x7801;&#x5668;&#xFF0C;&#x5C31;&#x8981;&#x76AE;&#x8FD9;&#x4E00;&#x4E0B;&#x3002;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;[&#x5DF2;&#x5904;&#x7406;] &quot;</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//&#x89E3;&#x7801;&#x5668;&#x672C;&#x8D28;&#x4E0A;&#x4E5F;&#x7B97;&#x662F;&#x4E00;&#x79CD;ChannelInboundHandlerAdapter&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x8BF7;&#x6C42;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;&#x53EF;&#x4EE5;&#xFF0C;&#x4E0D;&#x8DDF;&#x4F60;&#x591A;BB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x53D1;&#x5B57;&#x7B26;&#x4E32;&#x56DE;&#x53BB;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">//&#x6700;&#x540E;&#x518D;&#x8F6C;&#x6210;ByteBuf</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringToStringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x5148;&#x4ECE;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5F00;&#x59CB;</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6570;&#x636E;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x5904;&#x7406;&#x6700;&#x540E;&#x518D;&#x56DE;&#x5230;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/30.jpg" alt="image-20220511133025492"></p><p>&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x63D0;&#x5230;&#x7684;&#x7C98;&#x5305;/&#x62C6;&#x5305;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x89E3;&#x7801;&#x5668;&#x89E3;&#x51B3;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedLengthFrameDecoder</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token comment">//&#x7B2C;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4F7F;&#x7528;&#x5B9A;&#x957F;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x90FD;&#x8981;&#x662F;&#x6307;&#x5B9A;&#x957F;&#x5EA6;</span>
              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DelimiterBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;!&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//&#x7B2C;&#x4E8C;&#x79CD;&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4EE5;&#x611F;&#x53F9;&#x53F7;&#x4E3A;&#x5206;&#x9694;&#x7B26;</span>
              <span class="token comment">//&#x5728;&#x6536;&#x5230;&#x5206;&#x9694;&#x7B26;&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x90FD;&#x4F5C;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x5185;&#x5BB9;</span>
</code></pre><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LengthFieldBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//&#x7B2C;&#x4E09;&#x79CD;&#x65B9;&#x6848;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x5934;&#x90E8;&#x6DFB;&#x52A0;&#x957F;&#x5EA6;&#x4FE1;&#x606F;&#xFF0C;&#x6765;&#x786E;&#x5B9A;&#x5F53;&#x524D;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x5177;&#x4F53;&#x957F;&#x5EA6;&#x662F;&#x591A;&#x5C11;</span>
        <span class="token comment">//offset&#x662F;&#x4ECE;&#x54EA;&#x91CC;&#x5F00;&#x59CB;&#xFF0C;length&#x662F;&#x957F;&#x5EA6;&#x4FE1;&#x606F;&#x5360;&#x591A;&#x5C11;&#x5B57;&#x8282;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x4ECE;0&#x5F00;&#x59CB;&#x8BFB;4&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt; &#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LengthFieldPrepender</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x53D1;&#x9001;&#x65F6;&#x4E5F;&#x9700;&#x8981;&#x5C06;&#x957F;&#x5EA6;&#x62FC;&#x5230;&#x524D;&#x9762;&#x53BB;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x6709;&#x5173;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x5148;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p><h3 id="&#x5B9E;&#x73B0;http&#x534F;&#x8BAE;&#x901A;&#x4FE1;"><a name="&#x5B9E;&#x73B0;http&#x534F;&#x8BAE;&#x901A;&#x4FE1;" class="plugin-anchor" href="#&#x5B9E;&#x73B0;http&#x534F;&#x8BAE;&#x901A;&#x4FE1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B9E;&#x73B0;HTTP&#x534F;&#x8BAE;&#x901A;&#x4FE1;</h3><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;Netty&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x4F7F;&#x7528;&#x4E00;&#x4E0B;&#x652F;&#x6301;HTTP&#x534F;&#x8BAE;&#x7684;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#x3002;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//Http&#x8BF7;&#x6C42;&#x89E3;&#x7801;&#x5668;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x770B;&#x770B;&#x662F;&#x4E2A;&#x5565;&#x7C7B;&#x578B;</span>
                  <span class="token comment">//&#x6536;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ED9;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x56DE;&#x53BB;</span>
                <span class="token class-name">FullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpVersion</span><span class="token punctuation">.</span><span class="token constant">HTTP_1_1</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//HTTP&#x7248;&#x672C;&#x4E3A;1.1&#xFF0C;&#x72B6;&#x6001;&#x7801;&#x5C31;OK&#xFF08;200&#xFF09;&#x5373;&#x53EF;</span>
                  <span class="token comment">//&#x76F4;&#x63A5;&#x5411;&#x54CD;&#x5E94;&#x5185;&#x5BB9;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;</span>
                response<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x53D1;&#x9001;&#x54CD;&#x5E94;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//HTTP&#x8BF7;&#x6C42;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BB0;&#x5F97;&#x5173;&#x95ED;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpResponseEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x54CD;&#x5E94;&#x8BB0;&#x5F97;&#x4E5F;&#x8981;&#x7F16;&#x7801;&#x540E;&#x53D1;&#x9001;&#x54E6;</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5668;&#x5427;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/31.jpg" alt="image-20220511142040941"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x6210;&#x529F;&#x63A5;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#xFF0C;&#x7136;&#x540E;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;&#x4E86;&#x4EE5;&#x4E0B;&#x7C7B;&#x578B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/32.jpg" alt="image-20220511142121619"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x662F;&#x4E00;&#x4E2A;DefaultHttpRequest+LastHttpContent$1&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x7EC4;&#x662F;&#x56E0;&#x4E3A;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x4E86;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x4E4B;&#x540E;&#x7D27;&#x63A5;&#x7740;&#x8BF7;&#x6C42;&#x4E86;&#x6211;&#x4EEC;&#x7F51;&#x7AD9;&#x7684;favicon&#x56FE;&#x6807;&#x3002;</p><p>&#x8FD9;&#x6837;&#x628A;&#x6570;&#x636E;&#x5206;&#x5F00;&#x5904;&#x7406;&#x80AF;&#x5B9A;&#x662F;&#x4E0D;&#x884C;&#x7684;&#xFF0C;&#x8981;&#x662F;&#x76F4;&#x63A5;&#x6574;&#x5408;&#x6210;&#x4E00;&#x4E2A;&#x591A;&#x597D;&#xFF0C;&#x5B89;&#x6392;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//Http&#x8BF7;&#x6C42;&#x89E3;&#x7801;&#x5668;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//&#x641E;&#x4E00;&#x4E2A;&#x805A;&#x5408;&#x5668;&#xFF0C;&#x5C06;&#x5185;&#x5BB9;&#x805A;&#x5408;&#x4E3A;&#x4E00;&#x4E2A;FullHttpRequest&#xFF0C;&#x53C2;&#x6570;&#x662F;&#x6700;&#x5927;&#x5185;&#x5BB9;&#x957F;&#x5EA6;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">FullHttpRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FullHttpRequest</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#xFF1A;&quot;</span><span class="token operator">+</span>request<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span>
                <span class="token class-name">FullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpVersion</span><span class="token punctuation">.</span><span class="token constant">HTTP_1_1</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeCharSequence</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpResponseEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8BFB;&#x53D6;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x4E86;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/33.jpg" alt="image-20220511143318500"></p><p>&#x6211;&#x4EEC;&#x6765;&#x8BD5;&#x8BD5;&#x770B;&#x641E;&#x4E2A;&#x9759;&#x6001;&#x9875;&#x9762;&#x4EE3;&#x7406;&#x73A9;&#x73A9;&#xFF0C;&#x62FF;&#x51FA;&#x6211;&#x4EEC;&#x7684;&#x9648;&#x5E74;&#x8001;&#x6A21;&#x677F;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/34.jpg" alt="image-20220511144020424"></p><p>&#x5168;&#x90E8;&#x653E;&#x8FDB;Resource&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x4E00;&#x4F1A;&#x6839;&#x636E;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x4E86;&#xFF0C;&#x5148;&#x5B89;&#x6392;&#x4E00;&#x4E2A;&#x89E3;&#x6790;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x89E3;&#x6790;&#x8DEF;&#x5F84;&#x7136;&#x540E;&#x5C06;&#x9759;&#x6001;&#x9875;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x8FD4;&#x56DE;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageResolver</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x76F4;&#x63A5;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PageResolver</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PageResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PageResolver</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

      <span class="token comment">//&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x7ED9;&#x8FDB;&#x6765;&#xFF0C;&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x9875;&#x9762;&#x62FF;&#x5230;&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x6362;&#x6210;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x5305;&#x53D1;&#x56DE;&#x53BB;</span>
    <span class="token keyword">public</span> <span class="token class-name">FullHttpResponse</span> <span class="token function">resolveResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>  <span class="token comment">//&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x8DEF;&#x5F84;&#x8BF7;&#x6C42;</span>
            path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;index.html&quot;</span> <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x5982;&#x679C;&#x662F;&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x6839;&#x8DEF;&#x5F84;&#xFF0C;&#x90A3;&#x5C31;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;index&#x9875;&#x9762;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x8BE5;&#x8FD4;&#x56DE;&#x4EC0;&#x4E48;&#x8DEF;&#x5F84;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x8FD4;&#x56DE;&#x4EC0;&#x4E48;</span>
            <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> stream <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>stream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x62FF;&#x5230;&#x6587;&#x4EF6;&#x8F93;&#x5165;&#x6D41;&#x4E4B;&#x540E;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x9875;&#x9762;</span>
                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>stream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">packet</span><span class="token punctuation">(</span><span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x6570;&#x636E;&#x5148;&#x8BFB;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x4EA4;&#x7ED9;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x6253;&#x5305;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
          <span class="token comment">//&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E00;&#x5F8B;&#x8FD4;&#x56DE;404</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">packet</span><span class="token punctuation">(</span><span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">NOT_FOUND</span><span class="token punctuation">,</span> <span class="token string">&quot;404 Not Found!&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

      <span class="token comment">//&#x5305;&#x88C5;&#x6210;FullHttpResponse&#xFF0C;&#x628A;&#x72B6;&#x6001;&#x7801;&#x548C;&#x6570;&#x636E;&#x5199;&#x8FDB;&#x53BB;</span>
    <span class="token keyword">private</span> <span class="token class-name">FullHttpResponse</span> <span class="token function">packet</span><span class="token punctuation">(</span><span class="token class-name">HttpResponseStatus</span> status<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">FullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpVersion</span><span class="token punctuation">.</span><span class="token constant">HTTP_1_1</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x89E3;&#x6790;&#x5C31;&#x5199;&#x597D;&#x4E86;&#xFF0C;&#x63A5;&#x7740;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//Http&#x8BF7;&#x6C42;&#x89E3;&#x7801;&#x5668;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//&#x641E;&#x4E00;&#x4E2A;&#x805A;&#x5408;&#x5668;&#xFF0C;&#x5C06;&#x5185;&#x5BB9;&#x805A;&#x5408;&#x4E3A;&#x4E00;&#x4E2A;FullHttpRequest&#xFF0C;&#x53C2;&#x6570;&#x662F;&#x6700;&#x5927;&#x5185;&#x5BB9;&#x957F;&#x5EA6;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">FullHttpRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FullHttpRequest</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                  <span class="token comment">//&#x8BF7;&#x6C42;&#x8FDB;&#x6765;&#x4E86;&#x76F4;&#x63A5;&#x8D70;&#x89E3;&#x6790;</span>
                <span class="token class-name">PageResolver</span> resolver <span class="token operator">=</span> <span class="token class-name">PageResolver</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>resolver<span class="token punctuation">.</span><span class="token function">resolveResource</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpResponseEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#x6765;&#x8BD5;&#x8BD5;&#x770B;&#x5427;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/35.jpg" alt="image-20220511150714100"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x9875;&#x9762;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5C55;&#x793A;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x6709;Tomcat&#x54EA;&#x5473;&#x4E86;&#x3002;</p><h3 id="&#x5176;&#x4ED6;&#x5185;&#x7F6E;handler&#x4ECB;&#x7ECD;"><a name="&#x5176;&#x4ED6;&#x5185;&#x7F6E;handler&#x4ECB;&#x7ECD;" class="plugin-anchor" href="#&#x5176;&#x4ED6;&#x5185;&#x7F6E;handler&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5176;&#x4ED6;&#x5185;&#x7F6E;Handler&#x4ECB;&#x7ECD;</h3><p>Netty&#x4E5F;&#x4E3A;&#x6211;&#x4EEC;&#x5185;&#x7F6E;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x6BD4;&#x8F83;&#x597D;&#x7528;&#x7684;Handler&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8981;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;Handler&#xFF0C;&#x5728;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x6253;&#x5370;&#x76F8;&#x5173;&#x65E5;&#x5FD7;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><p>&#x65E5;&#x5FD7;&#x7EA7;&#x522B;&#x6211;&#x4EEC;&#x9009;&#x62E9;INFO&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x4E00;&#x4E0B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/36.jpg" alt="image-20220512125851248"></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x5185;&#x5BB9;&#x548C;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x90FD;&#x4F1A;&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#x51FA;&#x73B0;&#xFF0C;&#x5305;&#x62EC;&#x8BE6;&#x7EC6;&#x7684;&#x6570;&#x636E;&#x5305;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#xFF0C;&#x8BF7;&#x6C42;&#x5934;&#x4FE1;&#x606F;&#x90FD;&#x662F;&#x5B8C;&#x6574;&#x5730;&#x6253;&#x5370;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x4E0A;&#x7684;&#x3002;</p><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Handler&#x5BF9;IP&#x5730;&#x5740;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x4E0D;&#x5E0C;&#x671B;&#x67D0;&#x4E9B;IP&#x5730;&#x5740;&#x8FDE;&#x63A5;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuleBasedIpFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IpFilterRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">InetSocketAddress</span> inetSocketAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token operator">!</span>inetSocketAddress<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                  <span class="token comment">//&#x8FDB;&#x884C;&#x5339;&#x914D;&#xFF0C;&#x8FD4;&#x56DE;false&#x8868;&#x793A;&#x5339;&#x914D;&#x5931;&#x8D25;</span>
                  <span class="token comment">//&#x5982;&#x679C;&#x5339;&#x914D;&#x5931;&#x8D25;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x6839;&#x636E;&#x4E0B;&#x9762;&#x7684;&#x7C7B;&#x578B;&#x51B3;&#x5B9A;&#x8BE5;&#x5E72;&#x4EC0;&#x4E48;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x662F;&#x672C;&#x5730;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x90A3;&#x5C31;&#x62D2;&#x7EDD;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">IpFilterRuleType</span> <span class="token function">ruleType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">IpFilterRuleType</span><span class="token punctuation">.</span><span class="token constant">REJECT</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7C7B;&#x578B;&#xFF0C;REJECT&#x8868;&#x793A;&#x62D2;&#x7EDD;&#x8FDE;&#x63A5;&#xFF0C;ACCEPT&#x8868;&#x793A;&#x5141;&#x8BB8;&#x8FDE;&#x63A5;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/37.jpg" alt="image-20220512130926968"></p><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x90A3;&#x4E9B;&#x957F;&#x671F;&#x5904;&#x4E8E;&#x7A7A;&#x95F2;&#x7684;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1A;</p><pre class="language-"><code class="lang-java">channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IdleStateHandler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//IdleStateHandler&#x80FD;&#x591F;&#x4FA6;&#x6D4B;&#x8FDE;&#x63A5;&#x7A7A;&#x95F2;&#x72B6;&#x6001;</span>
        <span class="token comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8868;&#x793A;&#x8FDE;&#x63A5;&#x591A;&#x5C11;&#x79D2;&#x6CA1;&#x6709;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x662F;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x90FD;&#x7B97;&#xFF0C;0&#x8868;&#x793A;&#x7981;&#x7528;</span>
        <span class="token comment">//&#x4E8B;&#x4EF6;&#x9700;&#x8981;&#x5728;ChannelInboundHandlerAdapter&#x4E2D;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#x5904;&#x7406;</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;&#xFF1A;&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x6536;&#x5230;&#xFF01;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token comment">//&#x6CA1;&#x60F3;&#x5230;&#x5427;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x539F;&#x6765;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x7528;&#x7684;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>evt <span class="token keyword">instanceof</span> <span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">IdleStateEvent</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> evt<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">IdleState</span><span class="token punctuation">.</span><span class="token constant">WRITER_IDLE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x597D;&#x4E45;&#x90FD;&#x6CA1;&#x5199;&#x4E86;&#xFF0C;&#x770B;&#x89C6;&#x9891;&#x7684;&#x4F60;&#x771F;&#x7684;&#x6709;&#x8BA4;&#x771F;&#x5728;&#x8DDF;&#x7740;&#x6572;&#x5417;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">IdleState</span><span class="token punctuation">.</span><span class="token constant">READER_IDLE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x5F88;&#x4E45;&#x6CA1;&#x6709;&#x8BFB;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x4E86;&#xFF0C;&#x597D;&#x5BC2;&#x5BDE;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8D85;&#x8FC7;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E0D;&#x53D1;&#x9001;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x8FD9;&#x6837;&#xFF1A;</p><p><img src="https://tencent.cos.mobaijun.com/img/gitbook/java/NIO/Java NIO&#xFF08;&#x4E8C;&#xFF09;/38.jpg" alt="image-20220512131845296"></p><p>&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5173;&#x6389;&#x90A3;&#x4E9B;&#x5360;&#x7740;&#x8305;&#x5751;&#x4E0D;&#x62C9;&#x5C4E;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p><h3 id="&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x6E90;&#x7801;&#x89E3;&#x8BFB;"><a name="&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x6E90;&#x7801;&#x89E3;&#x8BFB;" class="plugin-anchor" href="#&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x6E90;&#x7801;&#x89E3;&#x8BFB;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x6E90;&#x7801;&#x89E3;&#x8BFB;</h3><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5B8C;&#x6210;&#x4E86;&#x5BF9;Netty&#x57FA;&#x672C;&#x529F;&#x80FD;&#x7684;&#x8BB2;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x6700;&#x540E;&#x5C31;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;Netty&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x4EE5;&#x53CA;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x3002;</p><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x6574;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x662F;&#x5728;bind&#x4E4B;&#x540E;&#x542F;&#x52A8;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x4E0B;&#x624B;&#xFF0C;&#x4E0D;&#x591A;BB&#x76F4;&#x63A5;&#x4E0A;&#x6E90;&#x7801;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> inetPort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>inetPort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8F6C;&#x6362;&#x6210;InetSocketAddress&#x5BF9;&#x8C61;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FDB;&#x6765;&#x4E4B;&#x540E;&#x53D1;&#x73B0;&#x662F;&#x8C03;&#x7528;&#x7684;&#x5176;&#x4ED6;&#x7ED1;&#x5B9A;&#x65B9;&#x6CD5;&#xFF0C;&#x7EE7;&#x7EED;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x518D;&#x6B21;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#xFF0C;&#x770B;&#x770B;EventLoopGroup&#x548C;Channel&#x6307;&#x5B9A;&#x4E86;&#x6CA1;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBind</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span><span class="token punctuation">)</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> <span class="token string">&quot;localAddress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x770B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token class-name">ChannelFuture</span> <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4E0A;&#x6765;&#x7B2C;&#x4E00;&#x53E5;&#x521D;&#x59CB;&#x5316;&#x7136;&#x540E;&#x6CE8;&#x518C;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x770B;&#x770B;&#x662F;&#x600E;&#x4E48;&#x6CE8;&#x518C;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> <span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        channel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channelFactory<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x901A;&#x8FC7;channelFactory&#x521B;&#x5EFA;&#x65B0;&#x7684;Channel&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x8BBE;&#x5B9A;&#x7684;NioServerSocketChannel</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x63A5;&#x7740;&#x5BF9;&#x521B;&#x5EFA;&#x597D;&#x7684;NioServerSocketChannel&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x5C06;&#x901A;&#x9053;&#x6CE8;&#x518C;&#x5230;bossGroup&#x4E2D;&#x7684;&#x4E00;&#x4E2A;EventLoop&#x4E2D;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x5BF9;&#x521B;&#x5EFA;&#x597D;&#x7684;ServerSocketChannel&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setChannelOptions</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newOptionsArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setAttributes</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newAttributesArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;Handler&#xFF0C;&#x5728;Handler&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x5411;EventLoop&#x4E2D;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5C06;ServerBootstrapAcceptor&#x6DFB;&#x52A0;&#x5230;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;</span>
    <span class="token comment">//&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684;ServerSocketChannel&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x65F6;&#x5C31;&#x80FD;Accept&#x4E86;</span>
    p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelHandler</span> handler <span class="token operator">=</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>handler<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            ch<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token comment">//&#x8FD9;&#x91CC;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5C06;ServerBootstrapAcceptor&#x6DFB;&#x52A0;&#x5230;ServerSocketChannel&#x7684;pipeline&#x4E2D;</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrapAcceptor</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> currentChildGroup<span class="token punctuation">,</span> currentChildHandler<span class="token punctuation">,</span> currentChildOptions<span class="token punctuation">,</span> currentChildAttrs<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;ServerBootstrapAcceptor&#x600E;&#x4E48;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x5B83;&#x7684;<code>channelRead</code>&#x65B9;&#x6CD5;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">//&#x5F53;&#x5E95;&#x5C42;NIO&#x7684;ServerSocketChannel&#x7684;Selector&#x6709;OP_ACCEPT&#x4E8B;&#x4EF6;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;NioEventLoop&#x4F1A;&#x63A5;&#x6536;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#xFF0C;&#x521B;&#x5EFA;SocketChannel&#xFF0C;&#x5E76;&#x89E6;&#x53D1;channelRead&#x56DE;&#x8C03;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x6B64;&#x65F6;msg&#x5C31;&#x662F;Accept&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#x7684;Channel&#x5BF9;&#x8C61;</span>
    <span class="token keyword">final</span> <span class="token class-name">Channel</span> child <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span><span class="token punctuation">)</span>msg<span class="token punctuation">;</span>
      <span class="token comment">//&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x5C06;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7F16;&#x5199;&#x7684;childHandler&#x6DFB;&#x52A0;&#x5230;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#xFF08;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x7A81;&#x7136;&#x5C31;&#x901A;&#x4E86;&#xFF09;</span>
    child<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>childHandler<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span><span class="token function">setChannelOptions</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>childOptions<span class="token punctuation">,</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>childAttrs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">//&#x76F4;&#x63A5;&#x5411;workGroup&#x4E2D;&#x7684;&#x4E00;&#x4E2A;EventLoop&#x6CE8;&#x518C;&#x65B0;&#x521B;&#x5EFA;&#x597D;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;Channel&#xFF0C;&#x7B49;&#x5F85;&#x8BFB;&#x5199;&#x4E8B;&#x4EF6;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>childGroup<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">//&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6CE8;&#x518C;&#x6210;&#x529F;&#xFF0C;&#x5C31;&#x5F3A;&#x5236;&#x5173;&#x95ED;&#x8FD9;&#x4E2A;Channel</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>future<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ServerBootstrap<span class="token punctuation">.</span>ServerBootstrapAcceptor</span><span class="token punctuation">.</span><span class="token function">forceClose</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><p>&#x6240;&#x4EE5;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BB2;&#x89E3;&#x7684;&#x4E3B;&#x4ECE;Reactor&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x53EA;&#x8981;&#x524D;&#x9762;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5F88;&#x597D;&#x63A8;&#x65AD;&#x3002;</p><p>&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x6CE8;&#x518C;&#xFF0C;&#x5728;&#x4E4B;&#x524D;NIO&#x9636;&#x6BB5;&#x6211;&#x4EEC;&#x4E5F;&#x662F;&#x9700;&#x8981;&#x5C06;Channel&#x6CE8;&#x518C;&#x5230;&#x5BF9;&#x5E94;&#x7684;Selector&#x624D;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x9009;&#x62E9;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultChannelPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x8F6C;&#x6362;&#x6210;ChannelPromise&#x7EE7;&#x7EED;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token string">&quot;promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    promise<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8C03;&#x7528;Channel&#x7684;Unsafe&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x8FDB;&#x884C;&#x6CE8;&#x518C;</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x7EE7;&#x7EED;&#x5411;&#x4E0B;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">EventLoop</span> eventLoop<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventLoop <span class="token operator">=</span> eventLoop<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x8FD9;&#x91CC;&#x662F;&#x7EE7;&#x7EED;&#x8C03;&#x7528;register0&#x65B9;&#x6CD5;&#x5728;&#x8FDB;&#x884C;&#x6CE8;&#x518C;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x7EE7;&#x7EED;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">register0</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">boolean</span> firstRegistration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>neverRegistered<span class="token punctuation">;</span>
        <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x6267;&#x884C;AbstractNioChannel&#x4E2D;&#x7684;doRegister&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6CE8;&#x518C;</span>
          <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>registered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">invokeHandlerAddedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">safeSetSuccess</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRegistration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x662F;&#x5173;&#x952E;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6765;&#x5230;&#x6700;&#x540E;&#x4E00;&#x7EA7;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> selected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token comment">//&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x8FD9;&#x91CC;&#x7EC8;&#x4E8E;&#x662F;&#x771F;&#x6B63;&#x7684;&#x8FDB;&#x884C;&#x4E86;&#x6CE8;&#x518C;&#xFF0C;javaChannel()&#x5F97;&#x5230;NIO&#x7684;Channel&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;register&#x65B9;&#x6CD5;</span>
              <span class="token comment">//&#x8FD9;&#x91CC;&#x5C31;&#x548C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;NIO&#x4E00;&#x6837;&#x4E86;&#xFF0C;&#x5C06;Channel&#x6CE8;&#x518C;&#x5230;Selector&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;Selector&#x4E5F;&#x662F;EventLoop&#x4E2D;&#x7684;</span>
              <span class="token comment">//&#x4F46;&#x662F;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;ops&#x53C2;&#x6570;&#x662F;0&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E0D;&#x76D1;&#x542C;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>selectionKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrappedSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x4E0A;&#x4E00;&#x7EA7;&#xFF0C;&#x5728;doRegister&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x62FF;&#x5230;selectionKey&#xFF0C;&#x4F46;&#x662F;&#x6CE8;&#x610F;&#x8FD9;&#x65F6;&#x8FD8;&#x6CA1;&#x6709;&#x76D1;&#x542C;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x770B;&#x5230;&#x4E0B;&#x9762;&#x7684;fireChannelActive&#x65B9;&#x6CD5;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPipeline</span> <span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AbstractChannelHandlerContext</span><span class="token punctuation">.</span><span class="token function">invokeChannelActive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4F20;&#x7684;&#x662F;&#x6D41;&#x6C34;&#x7EBF;&#x4E0A;&#x7684;&#x9ED8;&#x8BA4;&#x5934;&#x7ED3;&#x70B9;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invokeChannelActive</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">AbstractChannelHandlerContext</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EventExecutor</span> executor <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>executor<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        next<span class="token punctuation">.</span><span class="token function">invokeChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7EE7;&#x7EED;&#x5411;&#x4E0B;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                next<span class="token punctuation">.</span><span class="token function">invokeChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelInboundHandler</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x4F9D;&#x7136;&#x662F;&#x8C03;&#x7528;&#x7684;&#x5934;&#x7ED3;&#x70B9;&#x7684;channelActive&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5904;&#x7406;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeExceptionCaught</span><span class="token punctuation">(</span>var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x662F;&#x5934;&#x7ED3;&#x70B9;&#x7684;</span>
    ctx<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readIfIsAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x7EE7;&#x7EED;&#x5411;&#x4E0B;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readIfIsAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">DefaultChannelPipeline</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultChannelPipeline</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x7EE7;&#x7EED;&#x4E0D;&#x65AD;&#x5411;&#x4E0B;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unsafe<span class="token punctuation">.</span><span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x6700;&#x540E;&#x8FD9;&#x91CC;&#x4F1A;&#x8C03;&#x7528;beginRead&#x65B9;&#x6CD5;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assertEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBeginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x8C03;&#x7528;AbstractNioChannel&#x7684;doBeginRead&#x65B9;&#x6CD5;&#x4E86;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Exception</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeLater</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span>var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">voidPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><pre class="language-"><code class="lang-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doBeginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectionKey<span class="token punctuation">;</span>    <span class="token comment">//&#x5148;&#x62FF;&#x5230;&#x4E4B;&#x524D;&#x6CE8;&#x518C;&#x597D;&#x7684;selectionKey</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>readPending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> interestOps <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x628A;&#x76D1;&#x542C;&#x7684;&#x64CD;&#x4F5C;&#x53D6;&#x51FA;&#x6765;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>interestOps <span class="token operator">&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readInterestOp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x76D1;&#x542C;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;</span>
            selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>interestOps <span class="token operator">|</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readInterestOp<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x90A3;&#x5C31;&#x628A;readInterestOp&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;readInterestOp&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;OP_ACCEPT</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x8FD9;&#x6837;&#xFF0C;Channel&#x5728;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x4E5F;&#x5B8C;&#x6210;&#x4E86;&#x5E95;&#x5C42;&#x7684;&#x6CE8;&#x518C;&#xFF0C;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x7B49;&#x5F85;&#x4E8B;&#x4EF6;&#x4E86;&#x3002;</p><p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;<code>doBind</code>&#x65B9;&#x6CD5;&#x7684;&#x6CE8;&#x518C;&#x4F4D;&#x7F6E;&#xFF0C;&#x73B0;&#x5728;&#x6CE8;&#x518C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x6574;&#x4E2A;&#x4E3B;&#x4ECE;Reactor&#x7ED3;&#x6784;&#x5C31;&#x5DF2;&#x7ECF;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD8;&#x8981;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token class-name">ChannelFuture</span> <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x76EE;&#x524D;&#x521D;&#x59CB;&#x5316;&#x548C;&#x6CE8;&#x518C;&#x90FD;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x4E86;</span>
    <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel <span class="token operator">=</span> regFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&#x7531;&#x4E8E;&#x662F;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;ChannelFuture&#x62FF;&#x5230;&#x5BF9;&#x5E94;&#x7684;ServerSocketChannel&#x5BF9;&#x8C61;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x5982;&#x679C;&#x8BF4;&#x521D;&#x59CB;&#x5316;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;</span>
        <span class="token class-name">ChannelPromise</span> promise <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">newPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x76F4;&#x63A5;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x7ED1;&#x5B9A;</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">//&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x641E;&#x5B8C;&#xFF0C;&#x90A3;&#x5C31;&#x521B;Promis&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;</span>
        <span class="token keyword">final</span> <span class="token class-name">PendingRegistrationPromise</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingRegistrationPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        regFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">Throwable</span> cause <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cause <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    promise<span class="token punctuation">.</span><span class="token function">registered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span><span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6700;&#x540E;&#x90FD;&#x4F1A;&#x8D70;&#x5230;<code>doBind0</code>&#x65B9;&#x6CD5;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">doBind0</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> regFuture<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x6700;&#x540E;&#x4F1A;&#x5411;Channel&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x5230;&#x7684;EventLoop&#x4E2D;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4EFB;&#x52A1;</span>
    channel<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//&#x8FD9;&#x91CC;&#x624D;&#x662F;&#x771F;&#x6B63;&#x8C03;&#x7528;Channel&#x5E95;&#x5C42;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x64CD;&#x4F5C;</span>
                channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">.</span><span class="token constant">CLOSE_ON_FAILURE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x81F3;&#x6B64;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x7ED3;&#x675F;&#x3002;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8FD8;&#x63D0;&#x5230;&#x4E86;NIO&#x7684;&#x7A7A;&#x8F6E;&#x8BE2;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;Netty&#x662F;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5B9A;&#x4F4D;&#x5230;NioEventLoop&#x4E2D;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token comment">//&#x7531;&#x4E8E;&#x4EE3;&#x7801;&#x592A;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x7701;&#x7565;&#x5927;&#x90E8;&#x5206;&#x4EE3;&#x7801;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> var34<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                strategy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>curDeadlineNanos<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x9996;&#x5148;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x8FDB;&#x884C;Selector.select()&#x64CD;&#x4F5C;&#xFF0C;&#x8DDF;NIO&#x662F;&#x4E00;&#x6837;&#x7684;</span>
                            <span class="token punctuation">}</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

            <span class="token operator">++</span>selectCnt<span class="token punctuation">;</span>    <span class="token comment">//&#x6BCF;&#x6B21;&#x5524;&#x9192;&#x90FD;&#x4F1A;&#x8BA9;selectCnt&#x81EA;&#x589E;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cancelledKeys <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ranTasks <span class="token operator">&amp;&amp;</span> strategy <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unexpectedSelectorWakeup</span><span class="token punctuation">(</span>selectCnt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//&#x8FD9;&#x91CC;&#x4F1A;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x7A7A;&#x8F6E;&#x8BE2;BUG</span>
               <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x662F;&#x600E;&#x4E48;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7684;&#xFF1A;</p><pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">unexpectedSelectorWakeup</span><span class="token punctuation">(</span><span class="token keyword">int</span> selectCnt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Selector.select() returned prematurely because Thread.currentThread().interrupt() was called. Use NioEventLoop.shutdownGracefully() to shutdown the NioEventLoop.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x5982;&#x679C;selectCnt&#x5927;&#x4E8E;&#x7B49;&#x4E8E;SELECTOR_AUTO_REBUILD_THRESHOLD&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;512&#xFF09;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x91CD;&#x5EFA;Selector</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SELECTOR_AUTO_REBUILD_THRESHOLD</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> selectCnt <span class="token operator">&gt;=</span> <span class="token constant">SELECTOR_AUTO_REBUILD_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Selector.select() returned prematurely {} times in a row; rebuilding Selector {}.&quot;</span><span class="token punctuation">,</span> selectCnt<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rebuildSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&#x5F53;&#x524D;&#x7684;Selector&#x51FA;&#x73B0;BUG&#x4E86;&#xFF0C;&#x5F97;&#x91CD;&#x5EFA;&#x4E00;&#x4E2A;Selector</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5F53;&#x6BCF;&#x6B21;&#x7A7A;&#x8F6E;&#x8BE2;&#x53D1;&#x751F;&#x65F6;&#x4F1A;&#x6709;&#x4E13;&#x95E8;&#x7684;&#x8BA1;&#x6570;&#x5668;+1&#xFF0C;&#x5982;&#x679C;&#x7A7A;&#x8F6E;&#x8BE2;&#x7684;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;512&#x6B21;&#xFF0C;&#x5C31;&#x8BA4;&#x4E3A;&#x5176;&#x89E6;&#x53D1;&#x4E86;&#x7A7A;&#x8F6E;&#x8BE2;bug&#xFF0C;&#x89E6;&#x53D1;bug&#x540E;&#xFF0C;Netty&#x76F4;&#x63A5;&#x91CD;&#x5EFA;&#x4E00;&#x4E2A;Selector&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x7684;Channel&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x5230;&#x65B0;&#x7684; Selector&#x4E0A;&#xFF0C;&#x5C06;&#x65E7;&#x7684; Selector&#x5173;&#x6389;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x9632;&#x6B62;&#x4E86;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x3002;</p><p></p><div id="gitalk-container"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script>window.onload = function() {gitbook.events.on("page.change", function() {var gitalk = new Gitalk({"clientID":"f0da19fb826f620b26d6","clientSecret":"666fa5dabfb7913cf38b23fd348cf75d6f673820","repo":".docs","owner":"april-projects","admin":["mobaijun"],"id":"/Java/NIO/Java NIO（二）.html"});gitalk.render("gitalk-container");});};var gitalk = new Gitalk({"clientID":"f0da19fb826f620b26d6","clientSecret":"666fa5dabfb7913cf38b23fd348cf75d6f673820","repo":".docs","owner":"april-projects","admin":["mobaijun"],"id":"/Java/NIO/Java NIO（二）.html"});gitalk.render("gitalk-container");</script><p></p><footer class="page-footer"><span class="copyright">Copyright &#xA9; &#x7248;&#x6743;&#x4FE1;&#x606F; all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A; 2023-05-05 06:07:56</span></footer><script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div><a href="Java NIO（一）.html" class="navigation navigation-prev" aria-label="Previous page: Java NIO（一）"><i class="fa fa-angle-left"></i> </a><a href="../SpringBoot笔记/" class="navigation navigation-next" aria-label="Next page: SpringBoot"><i class="fa fa-angle-right"></i></a></div><script>var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Java NIO（二）","level":"1.3.8.2","depth":3,"next":{"title":"SpringBoot","level":"1.3.9","depth":2,"path":"Java/SpringBoot笔记/README.md","ref":"Java/SpringBoot笔记/README.md","articles":[{"title":"SpringBoot笔记（一）","level":"1.3.9.1","depth":3,"path":"Java/SpringBoot笔记/SpringBoot笔记（一）.md","ref":"Java/SpringBoot笔记/SpringBoot笔记（一）.md","articles":[]},{"title":"SpringBoot笔记（二）","level":"1.3.9.2","depth":3,"path":"Java/SpringBoot笔记/SpringBoot笔记（二）.md","ref":"Java/SpringBoot笔记/SpringBoot笔记（二）.md","articles":[]},{"title":"SpringBoot笔记（三）","level":"1.3.9.3","depth":3,"path":"Java/SpringBoot笔记/SpringBoot笔记（三）.md","ref":"Java/SpringBoot笔记/SpringBoot笔记（三）.md","articles":[]},{"title":"SpringBoot笔记（四）","level":"1.3.9.4","depth":3,"path":"Java/SpringBoot笔记/SpringBoot笔记（四）.md","ref":"Java/SpringBoot笔记/SpringBoot笔记（四）.md","articles":[]},{"title":"SpringBoot笔记（五）","level":"1.3.9.5","depth":3,"path":"Java/SpringBoot笔记/SpringBoot笔记（五）.md","ref":"Java/SpringBoot笔记/SpringBoot笔记（五）.md","articles":[]}]},"previous":{"title":"Java NIO（一）","level":"1.3.8.1","depth":3,"path":"Java/NIO/Java NIO（一）.md","ref":"Java/NIO/Java NIO（一）.md","articles":[]},"dir":"ltr"},"config":{"plugins":["code","popup","prism","-lunr","gtalk","anchors","donate","favicon","-search","github","sharing","minifier","splitter","search-pro","-highlight","livereload","insert-logo","hide-element","-fontsettings","edit-link-plus","page-toc-button","tbfed-pagefooter","back-to-top-button","expandable-chapters-small","book-summary-scroll-position-saver"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © 版权信息","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"copyright":"Copyright © aleen42","minHeaderCount":"2","minHeaderDeep":"2"},"prism":{"css":["prismjs/themes/prism-tomorrow.min.css"],"lang":{"dockerfile":"docker","conf":"yaml","c++":"c"},"ignore":["mermaid","eval-js"]},"github":{"url":"https://github.com/april-projects/.docs"},"livereload":{},"book-summary-scroll-position-saver":{},"atoc":{"addClass":true,"className":"atoc"},"minifier":{"html":{},"css":{},"js":{}},"splitter":{},"search-pro":{},"edit-link-plus":{"label":"点我反馈","base":"https://github.com/april-projects/.docs/issues"},"popup":{},"code":{"copyButtons":true},"donate":{"alipay":"https://tencent.cos.mobaijun.com/img/icon/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"https://tencent.cos.mobaijun.com/img/icon/wechat.png","wechatText":"微信捐赠"},"hide-element":{"elements":[".gitbook-link","div.vpower.txt-right"]},"gtalk":{"clientID":"f0da19fb826f620b26d6","clientSecret":"666fa5dabfb7913cf38b23fd348cf75d6f673820","repo":".docs","owner":"april-projects","admin":["mobaijun"]},"favicon":{"shortcut":"https://tencent.cos.mobaijun.com/img/gitbook/favicon.ico","bookmark":"https://tencent.cos.mobaijun.com/img/gitbook/favicon.ico","appleTouch":"https://tencent.cos.mobaijun.com/img/gitbook/apple-touch-icon.png","appleTouchMore":{"120x120":"https://tencent.cos.mobaijun.com/img/gitbook/android-chrome-192x192.png","180x180":"https://tencent.cos.mobaijun.com/img/gitbook/android-chrome-192x192.png"}},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"back-to-top-button":{},"expandable-chapters-small":{},"sharing":{"all":["facebook","google","twitter","weibo","instapaper"],"facebook":true,"google":false,"instapaper":false,"twitter":true,"vk":false,"weibo":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"insert-logo":{"style":"background: none; max-height: 100px; min-height: 30px","url":"https://tencent.cos.mobaijun.com/img/icon/logo.png"}},"theme":"default","author":"April","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"April","language":"zh-hans","output.name":"site","links":{"sidebar":{"框架师":"https://www.mobaijun.com","GitHub":"https://github.com/mobaijun","Gitee":"https://gitee.com/mobaijun","寻·妙":"https://nav.mobaijun.com"}},"gitbook":"3.2.3","description":"April 项目组文档"},"file":{"path":"Java/NIO/Java NIO（二）.md","mtime":"2023-05-04T22:07:56.148Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-05-06T10:25:29.300Z"},"basePath":"../..","book":{"language":""}});
        });</script></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/theme.js"></script><script src="../../gitbook/gitbook-plugin-code/plugin.js"></script><script src="../../gitbook/gitbook-plugin-donate/plugin.js"></script><script src="../../gitbook/gitbook-plugin-github/plugin.js"></script><script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script><script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script><script src="../../gitbook/gitbook-plugin-insert-logo/plugin.js"></script><script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script><script src="../../gitbook/gitbook-plugin-edit-link-plus/plugin.js"></script><script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script><script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script><script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script><script src="../../gitbook/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script></body></html>